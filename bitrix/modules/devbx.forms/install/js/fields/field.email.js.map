{"version":3,"file":"field.email.js","sources":["../../../srcjs/vue-webform-public/fields/field.mixin.js","../../../srcjs/vue-webform-public/fields/field.email/devbx.form.layout.field.email.js"],"sourcesContent":["export default {\r\n    props: ['page', 'item', 'row', 'active', 'config'],\r\n    data() {\r\n        return {\r\n        };\r\n    },\r\n    mounted() {\r\n        this.item.component = this;\r\n    },\r\n    unmounted() {\r\n        this.item.component = false;\r\n    },\r\n    computed: {\r\n        labelFormatted() {\r\n            return this.$root.htmlFormatFields(BX.util.htmlspecialchars(this.config.label));\r\n        },\r\n\r\n        formLabelFormatted() {\r\n            return this.labelFormatted + (this.required ? ' <span class=\"devbx-webform-asterisk\">*</span>' : '');\r\n        },\r\n\r\n        helpTextFormatted() {\r\n            return this.$root.htmlFormatFields(this.config.helpText);\r\n        },\r\n\r\n        id() {\r\n            return 'devbx-webform-' + this.$.uid;\r\n        },\r\n\r\n        readonly() {\r\n            return this.$root.formReadonly || this.$root.checkCondition(this, this.config, 'readOnlyRule') === true;\r\n        },\r\n\r\n\r\n        required() {\r\n            return this.$root.checkCondition(this, this.config, 'requireRule') === true;\r\n        },\r\n\r\n        hasCustomError() {\r\n            return this.$root.checkCondition(this, this.config, 'showCustomError') === true;\r\n        },\r\n\r\n        errorMessage: {\r\n            get() {\r\n                return this.item.errorMessage;\r\n            },\r\n            set(value) {\r\n                this.item.errorMessage = value;\r\n            }\r\n        },\r\n    },\r\n    methods: {\r\n        checkRequired() {\r\n            if (!this.$root.validation)\r\n                return false;\r\n\r\n            if (typeof this.field === \"undefined\") {\r\n                console.error('computed field not defined');\r\n                return false;\r\n            }\r\n\r\n            if (this.required) {\r\n                if (typeof this.field.value === \"number\")\r\n                    return false;\r\n\r\n                if (typeof this.field.value === \"boolean\" && this.field.value)\r\n                    return false;\r\n\r\n                if (this.field.value === undefined || this.field.value === null || !this.field.value.length) {\r\n                    this.errorMessage = this.$root.formatString(this.$Bitrix.Loc.getMessage('DEVBX_WEB_FORM_ERR_FIELD_REQUIRED'), '#FIELD_NAME#', this.labelFormatted);\r\n                    return true;\r\n                }\r\n            }\r\n\r\n            return false;\r\n        },\r\n\r\n        checkCustomError()\r\n        {\r\n            if (!this.$root.validation)\r\n                return false;\r\n\r\n            if (this.config.customError && this.hasCustomError)\r\n            {\r\n                this.errorMessage = this.config.customError;\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        },\r\n\r\n        checkRuleErrors()\r\n        {\r\n            this.errorMessage = '';\r\n\r\n            if (this.checkRequired())\r\n                return true;\r\n\r\n            return this.checkCustomError();\r\n        },\r\n    },\r\n}","import './devbx.form.layout.field.email.css';\r\nimport fieldMixin from \"./../field.mixin\";\r\n\r\nBX.addCustomEvent(\"DevBxWebFormCreated\", function(app) {\r\n    app.component('devbx-form-layout-field-email', {\r\n        mixins: [fieldMixin],\r\n        data() {\r\n            return {\r\n                inputTimer: false\r\n            }\r\n        },\r\n        watch: {\r\n            'defaultValue': {\r\n                immediate: true,\r\n                handler: function (val) {\r\n                    if (!this.field.changed) {\r\n                        this.field.value = val;\r\n                    }\r\n                }\r\n            },\r\n        },\r\n        methods: {\r\n            onInput(event) {\r\n                let value = event.target.value;\r\n\r\n                let self = this;\r\n\r\n                if (this.inputTimer)\r\n                    clearTimeout(this.inputTimer);\r\n\r\n                /*\r\n                this.inputTimer = setTimeout(function () {\r\n\r\n                    self.inputTimer = false;\r\n                    self.onChange();\r\n\r\n                }, 300);\r\n                 */\r\n            },\r\n\r\n            onChange() {\r\n                if (!this.$refs.input)\r\n                    return;\r\n\r\n                let value = this.$refs.input.value.trim();\r\n\r\n                this.$refs.input.value = value;\r\n                this.field.value = value;\r\n                this.field.changed = true;\r\n\r\n                this.checkErrors();\r\n            },\r\n\r\n            validateEmail(email) {\r\n                return String(email)\r\n                    .toLowerCase()\r\n                    .match(\r\n                        /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|.(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/\r\n                    );\r\n            },\r\n\r\n            checkErrors() {\r\n                if (!this.$root.validation)\r\n                    return false;\r\n\r\n                if (this.field.value && !this.validateEmail(this.field.value))\r\n                {\r\n                    this.errorMessage = this.$root.formatString(\r\n                        this.$Bitrix.Loc.getMessage('DEVBX_WEB_FORM_ERR_INVALID_EMAIL'),\r\n                        ['#FIELD_NAME#'],\r\n                        [this.labelFormatted]);\r\n                    return true;\r\n                }\r\n\r\n                return this.checkRuleErrors();\r\n            },\r\n\r\n            setFocus() {\r\n                if (this.$refs.input)\r\n                    this.$refs.input.focus();\r\n            },\r\n        },\r\n        computed: {\r\n            defaultValue() {\r\n                return this.config.defaultValue;\r\n            },\r\n\r\n           field() {\r\n                return this.$root.formFieldByName['Fields.' + this.config.fieldName];\r\n            },\r\n\r\n            value: {\r\n                get() {\r\n                    return this.field.value;\r\n                },\r\n\r\n                set(value) {\r\n                    this.field.value = value.trim();\r\n                    this.field.changed = true;\r\n                },\r\n            },\r\n        },\r\n        template: `\r\n    <div class=\"devbx-webform-field\" :class=\"{'devbx-webform-required': required, 'devbx-webform--is-error': errorMessage.length}\">\r\n        <label class=\"devbx-webform-label\" :for=\"id\" v-html=\"formLabelFormatted\" v-if=\"!config.labelHidden\"></label>\r\n        <div class=\"devbx-webform-field-input\">\r\n            <input ref=\"input\"\r\n                autocomplete=\"off\" \r\n                class=\"devbx-webform-input devbx-webform-email\" \r\n                :id=\"id\" \r\n                type=\"text\" \r\n                :value=\"value\"\r\n                :placeholder=\"config.placeholder\" \r\n                :readonly=\"readonly\"\r\n                @input=\"onInput\"\r\n                @change=\"onChange\"\r\n                >\r\n        </div>\r\n        \r\n        <div class=\"devbx-webform-helptext\" v-if=\"helpTextFormatted.length>0\" v-html=\"helpTextFormatted\"></div>\r\n\r\n        <transition name=\"devbx-webform-field\">\r\n            <div class=\"devbx-webform-error-message\" v-if=\"errorMessage\" v-html=\"errorMessage\"></div>\r\n        </transition>\r\n    </div>\r\n    `\r\n    });\r\n});"],"names":["props","data","mounted","item","component","unmounted","computed","labelFormatted","$root","htmlFormatFields","BX","util","htmlspecialchars","config","label","formLabelFormatted","required","helpTextFormatted","helpText","id","$","uid","readonly","formReadonly","checkCondition","hasCustomError","errorMessage","get","set","value","methods","checkRequired","validation","field","console","error","undefined","length","formatString","$Bitrix","Loc","getMessage","checkCustomError","customError","checkRuleErrors","addCustomEvent","app","mixins","fieldMixin","inputTimer","watch","immediate","handler","val","changed","onInput","event","target","clearTimeout","onChange","$refs","input","trim","checkErrors","validateEmail","email","String","toLowerCase","match","setFocus","focus","defaultValue","formFieldByName","fieldName","template"],"mappings":"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"}