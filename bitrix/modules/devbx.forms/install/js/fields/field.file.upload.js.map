{"version":3,"file":"field.file.upload.js","sources":["../../../srcjs/vue-webform-public/fields/field.mixin.js","../../../srcjs/vue-webform-public/fields/field.file.upload/devbx.form.layout.field.file.upload.js"],"sourcesContent":["export default {\r\n    props: ['page', 'item', 'row', 'active', 'config'],\r\n    data() {\r\n        return {\r\n        };\r\n    },\r\n    mounted() {\r\n        this.item.component = this;\r\n    },\r\n    unmounted() {\r\n        this.item.component = false;\r\n    },\r\n    computed: {\r\n        labelFormatted() {\r\n            return this.$root.htmlFormatFields(BX.util.htmlspecialchars(this.config.label));\r\n        },\r\n\r\n        formLabelFormatted() {\r\n            return this.labelFormatted + (this.required ? ' <span class=\"devbx-webform-asterisk\">*</span>' : '');\r\n        },\r\n\r\n        helpTextFormatted() {\r\n            return this.$root.htmlFormatFields(this.config.helpText);\r\n        },\r\n\r\n        id() {\r\n            return 'devbx-webform-' + this.$.uid;\r\n        },\r\n\r\n        readonly() {\r\n            return this.$root.formReadonly || this.$root.checkCondition(this, this.config, 'readOnlyRule') === true;\r\n        },\r\n\r\n\r\n        required() {\r\n            return this.$root.checkCondition(this, this.config, 'requireRule') === true;\r\n        },\r\n\r\n        hasCustomError() {\r\n            return this.$root.checkCondition(this, this.config, 'showCustomError') === true;\r\n        },\r\n\r\n        errorMessage: {\r\n            get() {\r\n                return this.item.errorMessage;\r\n            },\r\n            set(value) {\r\n                this.item.errorMessage = value;\r\n            }\r\n        },\r\n    },\r\n    methods: {\r\n        checkRequired() {\r\n            if (!this.$root.validation)\r\n                return false;\r\n\r\n            if (typeof this.field === \"undefined\") {\r\n                console.error('computed field not defined');\r\n                return false;\r\n            }\r\n\r\n            if (this.required) {\r\n                if (typeof this.field.value === \"number\")\r\n                    return false;\r\n\r\n                if (typeof this.field.value === \"boolean\" && this.field.value)\r\n                    return false;\r\n\r\n                if (this.field.value === undefined || this.field.value === null || !this.field.value.length) {\r\n                    this.errorMessage = this.$root.formatString(this.$Bitrix.Loc.getMessage('DEVBX_WEB_FORM_ERR_FIELD_REQUIRED'), '#FIELD_NAME#', this.labelFormatted);\r\n                    return true;\r\n                }\r\n            }\r\n\r\n            return false;\r\n        },\r\n\r\n        checkCustomError()\r\n        {\r\n            if (!this.$root.validation)\r\n                return false;\r\n\r\n            if (this.config.customError && this.hasCustomError)\r\n            {\r\n                this.errorMessage = this.config.customError;\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        },\r\n\r\n        checkRuleErrors()\r\n        {\r\n            this.errorMessage = '';\r\n\r\n            if (this.checkRequired())\r\n                return true;\r\n\r\n            return this.checkCustomError();\r\n        },\r\n    },\r\n}","import './devbx.form.layout.field.file.upload.css';\r\nimport fieldMixin from \"./../field.mixin\";\r\n\r\nBX.addCustomEvent(\"DevBxWebFormCreated\", function(app) {\r\n\r\n    app.component('file-upload', VueUploadComponent);\r\n\r\n    app.component('devbx-form-layout-field-file-upload', {\r\n        mixins: [fieldMixin],\r\n        data() {\r\n            return {\r\n                files: [],\r\n                disableAdd: false,\r\n            };\r\n        },\r\n        methods: {\r\n            formatSize(bytes) {\r\n                let units = ['B', 'kB', 'MB', 'GB'],\r\n                    thresh = 1024;\r\n\r\n                if (Math.abs(bytes) < thresh) {\r\n                    return bytes + ' ' + units[0];\r\n                }\r\n\r\n                let u = 0;\r\n                const dp = 2;\r\n                const r = 10 ** dp;\r\n\r\n                do {\r\n                    bytes /= thresh;\r\n                    ++u;\r\n                } while (Math.round(Math.abs(bytes) * r) / r >= thresh && u < units.length - 1);\r\n\r\n                return bytes.toFixed(dp) + ' ' + units[u];\r\n            },\r\n\r\n            inputFile(newFile, oldFile) {\r\n                //response\r\n                if (newFile && oldFile && !newFile.active && oldFile.active) {\r\n                    if (newFile.response.status === 'success') {\r\n\r\n                        if (!Array.isArray(this.field.value))\r\n                            this.field.value = [];\r\n\r\n                        let data = newFile.response.data;\r\n                        data.uploaded = true;\r\n\r\n                        this.field.value.push(data);\r\n                        this.field.changed = true;\r\n\r\n                        this.$root.checkPageErrors(false, false);\r\n                    } else {\r\n\r\n                        if (newFile.response.errors) {\r\n                            let messages = [];\r\n\r\n                            newFile.response.errors.forEach(error => {\r\n                                messages.push(error.message);\r\n                            });\r\n\r\n                            this.$refs.upload.update(newFile, {error: messages.join(\"\\n\")});\r\n                        }\r\n                    }\r\n\r\n                    return;\r\n                }\r\n\r\n                if (!newFile && oldFile) {\r\n                    if (oldFile.success && oldFile.response.data && oldFile.response.data.fileId) {\r\n                        //delete action\r\n                    }\r\n\r\n                    return;\r\n                }\r\n\r\n                if (Boolean(newFile) !== Boolean(oldFile) || oldFile.error !== newFile.error) {\r\n                    if (!this.$refs.upload.active) {\r\n\r\n                        if (this.disableAdd) {\r\n                            this.$refs.upload.remove(newFile);\r\n                            return;\r\n                        }\r\n\r\n                        if (this.config.maximumNumberOfFiles > 0 && this.allFiles.length > this.config.maximumNumberOfFiles) {\r\n                            this.disableAdd = true;\r\n\r\n                            this.$refs.upload.remove(newFile);\r\n\r\n                            this.errorMessage = this.$root.formatString(this.$Bitrix.Loc.getMessage('DEVBX_WEB_FORM_FILE_UPLOAD_ERR_NUMBER_OF_FILES'),\r\n                                '#VALUE#', this.config.maximumNumberOfFiles);\r\n\r\n                            let self = this;\r\n\r\n                            setTimeout(function () {\r\n\r\n                                self.disableAdd = false;\r\n\r\n                            }, 100);\r\n\r\n                            return;\r\n                        }\r\n\r\n                        if (this.config.maximumFileSize > 0 && newFile.size > this.config.maximumFileSize * 1024 * 1024) {\r\n                            newFile.error = this.$root.formatString(this.$Bitrix.Loc.getMessage('DEVBX_WEB_FORM_FILE_UPLOAD_ERR_FILE_SIZE'),\r\n                                '#VALUE#', this.formatSize(this.config.maximumFileSize * 1024 * 1024));\r\n                            return;\r\n                        }\r\n\r\n                        if (this.allowedFileTypes.length > 0 && this.allowedFileTypes.indexOf(this.getFileExt(newFile.name)) < 0) {\r\n                            newFile.error = this.$Bitrix.Loc.getMessage('DEVBX_WEB_FORM_FILE_UPLOAD_ERR_INVALID_FILE_TYPE');\r\n                            return;\r\n                        }\r\n\r\n                        let URL = window.URL || window.webkitURL;\r\n\r\n                        if (URL) {\r\n                            this.$refs.upload.update(newFile, {blob: URL.createObjectURL(newFile.file)});\r\n                        }\r\n\r\n                        this.$refs.upload.active = true\r\n                    }\r\n\r\n                    return;\r\n                }\r\n\r\n                console.log(newFile, oldFile);\r\n            },\r\n\r\n            getFileExt(filename) {\r\n                let ext = filename.split('.').pop();\r\n\r\n                if (ext === filename)\r\n                    return '?';\r\n\r\n                return ext;\r\n            },\r\n\r\n            addFile() {\r\n                window.upload = this.$refs.upload;\r\n\r\n                this.$refs.upload.$refs.input.click();\r\n\r\n\r\n                //this.$refs.upload.$el.querySelector('input').click();\r\n            },\r\n\r\n            removeFile(file) {\r\n                if (file.instance) {\r\n                    this.$refs.upload.remove(file.instance);\r\n                }\r\n\r\n                this.value.every((item, index) => {\r\n                    if (item.fileId !== file.fileId)\r\n                        return true;\r\n\r\n                    if (item.uploaded) {\r\n                        BX.ajax.runAction('devbx:forms.api.webform.fieldRequest', {\r\n                            data: {\r\n                                sid: this.$root.sid,\r\n                                fieldId: this.config.systemId,\r\n                                params: {\r\n                                    action: 'deleteFile',\r\n                                    fileId: item.fileId,\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n\r\n                    this.value.splice(index, 1);\r\n\r\n                    this.checkErrors();\r\n\r\n                    return false;\r\n                });\r\n            },\r\n\r\n            checkErrors() {\r\n                if (this.checkRuleErrors())\r\n                    return true;\r\n\r\n                return false;\r\n            }\r\n        },\r\n        computed: {\r\n            postHeaders() {\r\n                let result = {};\r\n\r\n                result['X-Bitrix-Csrf-Token'] = BX.bitrix_sessid();\r\n\r\n                return result;\r\n            },\r\n\r\n            postData() {\r\n                let result = {\r\n                    sid: this.$root.sid,\r\n                    fieldId: this.config.systemId,\r\n                };\r\n\r\n                result['params[action]'] = 'upload';\r\n\r\n                return result;\r\n            },\r\n\r\n            allFiles() {\r\n\r\n                let result = JSON.parse(JSON.stringify(this.value)),\r\n                    fileMap = {};\r\n\r\n                result.forEach(file => {\r\n                    file.id = file.fileId;\r\n                    fileMap[file.fileId] = file;\r\n                });\r\n\r\n                this.files.forEach(file => {\r\n                    if (file.response.data && file.response.data.fileId && fileMap[file.response.data.fileId]) {\r\n                        fileMap[file.response.data.fileId].instance = file;\r\n                        return;\r\n                    }\r\n\r\n                    if (!file.success || file.error) {\r\n                        result.push({\r\n                            id: file.id,\r\n                            name: file.name,\r\n                            size: file.size,\r\n                            instance: file,\r\n                        });\r\n                    }\r\n                });\r\n\r\n                return result;\r\n            },\r\n\r\n            allowedFileTypes() {\r\n                return this.config.allowedFileTypes.split(',').map(v => v.trim()).filter(v => v.length > 0);\r\n            },\r\n\r\n            field() {\r\n                return this.$root.formFieldByName['Fields.' + this.config.fieldName];\r\n            },\r\n\r\n            value: {\r\n                get() {\r\n                    if (!Array.isArray(this.field.value))\r\n                        this.field.value = [];\r\n\r\n                    return this.field.value;\r\n                },\r\n\r\n                set(value) {\r\n                    this.field.value;\r\n                    this.field.changed = true;\r\n\r\n                    this.$root.checkPageErrors(false, false);\r\n                },\r\n            },\r\n\r\n            allowMultiple() {\r\n                return this.config.multiple && this.config.maximumNumberOfFiles != 1;\r\n            },\r\n\r\n            allowUpload() {\r\n                if (this.config.multiple)\r\n                    return !(this.config.maximumNumberOfFiles > 0 && this.allFiles.length >= this.config.maximumNumberOfFiles);\r\n\r\n                return !this.allFiles.length;\r\n            },\r\n\r\n            inputName() {\r\n                return 'file-upload-'+this.config.systemId;\r\n            },\r\n        },\r\n        template: `\r\n    <div class=\"devbx-webform-field\" :class=\"{'devbx-webform-required': required, 'devbx-webform--is-error': errorMessage.length}\">\r\n        <span class=\"devbx-webform-label\" v-html=\"formLabelFormatted\" v-if=\"!config.labelHidden\">\r\n        </span>\r\n        \r\n        <div>\r\n            <div class=\"devbx-webform-file-upload-container\">\r\n                <div>                \r\n                    <button v-if=\"allowUpload\" \r\n                        class=\"devbx-webform-button\" \r\n                        :disabled=\"readonly\"\r\n                        @click=\"addFile\"\r\n                        >\r\n                        <span>{{$Bitrix.Loc.getMessage('DEVBX_WEB_FORM_FILE_UPLOAD_BUTTON')}}</span>\r\n                    </button>\r\n                    \r\n                    <file-upload\r\n                        class=\"devbx-webform-file-upload-zone\"\r\n                        post-action=\"/bitrix/services/main/ajax.php?action=devbx:forms.api.webform.fieldRequest\"\r\n                        v-model=\"files\"\r\n                        :headers=\"postHeaders\"\r\n                        :data=\"postData\"\r\n                        :multiple=\"allowMultiple\"\r\n                        :drop=\"allowUpload\"\r\n                        :drop-directory=\"true\"\r\n                        :disabled=\"readonly\"\r\n                        ref=\"upload\"\r\n                        @input-file=\"inputFile\"\r\n                        >\r\n                        <span v-if=\"allowUpload\">{{$Bitrix.Loc.getMessage('DEVBX_WEB_FORM_FILE_UPLOAD_DROPZONE')}}</span>\r\n                    </file-upload>\r\n                </div>                    \r\n            </div>\r\n            \r\n            <ul v-if=\"allFiles.length\" class=\"devbx-webform-file-upload-list\">\r\n                <li v-for=\"file in allFiles\" :key=\"file.id\">\r\n                <div>\r\n                    <img class=\"devbx-webform-file-upload-file-thumb\" v-if=\"file.preview\" :src=\"file.preview\">\r\n\r\n                    <svg class=\"devbx-webform-file-upload-file-icon\" viewBox=\"0 0 32 32\" style=\"width: 3em;height: 3em;vertical-align: middle;fill: #bdcccc;overflow: hidden;\">\r\n                        <path d=\"M 20.37 1.126 L 4.791 1.126 L 4.791 31.562 L 27.509 31.562 L 27.509 8.911 L 20.37 1.126 Z M 21.019 3.837 L 25.023 8.204 L 21.019 8.204 L 21.019 3.837 Z M 26.212 30.147 L 6.089 30.147 L 6.089 2.542 L 19.72 2.542 L 19.72 9.619 L 26.212 9.619 L 26.212 30.147 Z\" style=\"\"/>\r\n                        <rect x=\"7.474\" y=\"17.684\" width=\"17.264\" height=\"11.626\" style=\"fill: rgb(208, 219, 219);\"/>\r\n                        <text style=\"white-space: pre;fill: rgb(0, 0, 0);font-family: Arial, sans-serif;font-size: 5px;font-weight: bold;\" x=\"10\" y=\"25\">{{getFileExt(file.name)}}</text>\r\n                    </svg>\r\n\r\n                    <div class=\"devbx-webform-file-info\">\r\n                        <a class=\"devbx-webform-file-upload-link\" \r\n                            v-if=\"file.download\" \r\n                            :href=\"file.download\" target=\"_blank\">\r\n                            {{file.name}}\r\n                        </a>\r\n                        <a class=\"devbx-webform-file-upload-link\" \r\n                            v-else \r\n                            :href=\"file.instance.blob\" target=\"_blank\">\r\n                            {{file.name}}\r\n                        </a>\r\n                    \r\n                        <div class=\"devbx-webform-file-size\">{{formatSize(file.size)}}</div>\r\n                    </div>\r\n                    \r\n                    <button class=\"devbx-webform-button-download\" :title=\"file.name\" v-if=\"file.instance && file.instance.active\">\r\n                        <progress max=\"100\" :value=\"file.instance.progress\"></progress>\r\n                    </button>\r\n\r\n                    <button class=\"devbx-webform-button-upload-delete\" @click.stop.prevent=\"removeFile(file)\">\r\n<svg viewBox=\"0 0 500 500\" xml:space=\"preserve\" style=\"width:16px;height:16px;\">\r\n    <circle cx=\"249.9\" cy=\"250.4\" r=\"204.7\" stroke=\"#000000\" stroke-miterlimit=\"10\"/>\r\n    <circle cx=\"249.9\" cy=\"247.4\" fill=\"#FFFFFF\" r=\"181.8\" stroke=\"#000000\" stroke-miterlimit=\"10\"/>\r\n    <line fill=\"none\" stroke=\"#000000\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-miterlimit=\"10\" stroke-width=\"22\" x1=\"162\" x2=\"337.8\" y1=\"159.5\" y2=\"335.3\"/>\r\n    <line fill=\"none\" stroke=\"#000000\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-miterlimit=\"10\" stroke-width=\"22\" x1=\"337.8\" x2=\"162\" y1=\"159.5\" y2=\"335.3\"/>\r\n</svg>\r\n                    </button>\r\n                    </div>\r\n                    \r\n        <transition name=\"devbx-webform-field\">\r\n            <div class=\"devbx-webform-error-message\" v-if=\"file.instance && file.instance.error\">{{file.instance.error}}</div>\r\n        </transition>\r\n                    \r\n                </li>\r\n            </ul>                    \r\n        </div>\r\n    \r\n        <div class=\"devbx-webform-helptext\" v-if=\"helpTextFormatted.length>0\" v-html=\"helpTextFormatted\"></div>\r\n\r\n        <transition name=\"devbx-webform-field\">\r\n            <div class=\"devbx-webform-error-message\" v-if=\"errorMessage\" v-html=\"errorMessage\"></div>\r\n        </transition>\r\n    </div>\r\n    `\r\n    });\r\n});"],"names":["props","data","mounted","item","component","unmounted","computed","labelFormatted","$root","htmlFormatFields","BX","util","htmlspecialchars","config","label","formLabelFormatted","required","helpTextFormatted","helpText","id","$","uid","readonly","formReadonly","checkCondition","hasCustomError","errorMessage","get","set","value","methods","checkRequired","validation","field","console","error","undefined","length","formatString","$Bitrix","Loc","getMessage","checkCustomError","customError","checkRuleErrors","addCustomEvent","app","VueUploadComponent","mixins","fieldMixin","files","disableAdd","formatSize","bytes","units","thresh","Math","abs","u","dp","r","round","toFixed","inputFile","newFile","oldFile","active","response","status","Array","isArray","uploaded","push","changed","checkPageErrors","errors","messages","forEach","message","$refs","upload","update","join","success","fileId","Boolean","remove","maximumNumberOfFiles","allFiles","self","setTimeout","maximumFileSize","size","allowedFileTypes","indexOf","getFileExt","name","URL","window","webkitURL","blob","createObjectURL","file","log","filename","ext","split","pop","addFile","input","click","removeFile","instance","every","index","ajax","runAction","sid","fieldId","systemId","params","action","splice","checkErrors","postHeaders","result","bitrix_sessid","postData","JSON","parse","stringify","fileMap","map","v","trim","filter","formFieldByName","fieldName","allowMultiple","multiple","allowUpload","inputName","template"],"mappings":"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"}