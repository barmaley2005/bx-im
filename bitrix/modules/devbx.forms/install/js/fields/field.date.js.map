{"version":3,"file":"field.date.js","sources":["../../../srcjs/vue-webform-public/fields/field.mixin.js","../../../srcjs/vue-webform-public/fields/field.date/devbx.form.layout.field.date.js"],"sourcesContent":["export default {\r\n    props: ['page', 'item', 'row', 'active', 'config'],\r\n    data() {\r\n        return {\r\n        };\r\n    },\r\n    mounted() {\r\n        this.item.component = this;\r\n    },\r\n    unmounted() {\r\n        this.item.component = false;\r\n    },\r\n    computed: {\r\n        labelFormatted() {\r\n            return this.$root.htmlFormatFields(BX.util.htmlspecialchars(this.config.label));\r\n        },\r\n\r\n        formLabelFormatted() {\r\n            return this.labelFormatted + (this.required ? ' <span class=\"devbx-webform-asterisk\">*</span>' : '');\r\n        },\r\n\r\n        helpTextFormatted() {\r\n            return this.$root.htmlFormatFields(this.config.helpText);\r\n        },\r\n\r\n        id() {\r\n            return 'devbx-webform-' + this.$.uid;\r\n        },\r\n\r\n        readonly() {\r\n            return this.$root.formReadonly || this.$root.checkCondition(this, this.config, 'readOnlyRule') === true;\r\n        },\r\n\r\n\r\n        required() {\r\n            return this.$root.checkCondition(this, this.config, 'requireRule') === true;\r\n        },\r\n\r\n        hasCustomError() {\r\n            return this.$root.checkCondition(this, this.config, 'showCustomError') === true;\r\n        },\r\n\r\n        errorMessage: {\r\n            get() {\r\n                return this.item.errorMessage;\r\n            },\r\n            set(value) {\r\n                this.item.errorMessage = value;\r\n            }\r\n        },\r\n    },\r\n    methods: {\r\n        checkRequired() {\r\n            if (!this.$root.validation)\r\n                return false;\r\n\r\n            if (typeof this.field === \"undefined\") {\r\n                console.error('computed field not defined');\r\n                return false;\r\n            }\r\n\r\n            if (this.required) {\r\n                if (typeof this.field.value === \"number\")\r\n                    return false;\r\n\r\n                if (typeof this.field.value === \"boolean\" && this.field.value)\r\n                    return false;\r\n\r\n                if (this.field.value === undefined || this.field.value === null || !this.field.value.length) {\r\n                    this.errorMessage = this.$root.formatString(this.$Bitrix.Loc.getMessage('DEVBX_WEB_FORM_ERR_FIELD_REQUIRED'), '#FIELD_NAME#', this.labelFormatted);\r\n                    return true;\r\n                }\r\n            }\r\n\r\n            return false;\r\n        },\r\n\r\n        checkCustomError()\r\n        {\r\n            if (!this.$root.validation)\r\n                return false;\r\n\r\n            if (this.config.customError && this.hasCustomError)\r\n            {\r\n                this.errorMessage = this.config.customError;\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        },\r\n\r\n        checkRuleErrors()\r\n        {\r\n            this.errorMessage = '';\r\n\r\n            if (this.checkRequired())\r\n                return true;\r\n\r\n            return this.checkCustomError();\r\n        },\r\n    },\r\n}","import fieldMixin from \"./../field.mixin\";\r\n\r\nBX.addCustomEvent(\"DevBxWebFormCreated\", function(app) {\r\n    DatePicker.install(app);\r\n\r\n    app.component('devbx-form-layout-field-date', {\r\n        mixins: [fieldMixin],\r\n        data() {\r\n            return {\r\n                popupStyle: {},\r\n                timer: false,\r\n            }\r\n        },\r\n        computed: {\r\n            field() {\r\n                return this.$root.formFieldByName['Fields.' + this.config.fieldName];\r\n            },\r\n\r\n            value: {\r\n                get() {\r\n                    let i = parseInt(this.field.value);\r\n\r\n                    if (isNaN(i))\r\n                        return null;\r\n\r\n                    if (this.config.type === 'TIME')\r\n                        return (new Date(2000, 0, 1)).getTime() + (i * 1000);\r\n\r\n                    return i * 1000;\r\n                },\r\n\r\n                set(value) {\r\n                    if (value !== null)\r\n                    {\r\n                        if (this.config.type === 'TIME') {\r\n                            let d = new Date(value);\r\n\r\n                            value = (d.getHours() * 60 * 60) + (d.getMinutes() * 60) + d.getSeconds();\r\n                        } else {\r\n                            value = Math.floor(value / 1000);\r\n                        }\r\n                    }\r\n\r\n                    if (this.field.value !== value)\r\n                    {\r\n                        this.field.value = value;\r\n                        this.field.changed = true;\r\n                        this.$root.checkPageErrors(false, false);\r\n                    }\r\n                },\r\n            },\r\n\r\n            dateType() {\r\n                return this.config.type.toLowerCase();\r\n            },\r\n\r\n            dateFormat() {\r\n                switch (this.config.type) {\r\n                    case 'DATE':\r\n                        return BX.message['FORMAT_DATE'];\r\n                    case 'DATETIME':\r\n                        let value = BX.message['FORMAT_DATETIME'];\r\n\r\n                        value = value.replaceAll('MI', 'mm');\r\n                        value = value.replaceAll('SS', '');\r\n                        if (value.slice(-1) === ':') {\r\n                            value = value.slice(0, -1);\r\n                        }\r\n\r\n                        return value;\r\n                    case 'TIME':\r\n                        return 'HH:mm';\r\n                }\r\n\r\n                return '';\r\n            },\r\n\r\n            locale() {\r\n\r\n                let data = {\r\n                    formatLocale: {\r\n                        months: [],\r\n                        monthsShort: [],\r\n                        weekdays: [],\r\n                        weekdaysShort: [],\r\n                        weekdaysMin: [],\r\n                        firstDayOfWeek: 1,\r\n                        firstWeekContainsDate: 1\r\n                    },\r\n                    yearFormat: 'YYYY',\r\n                    monthFormat: 'MMM',\r\n                    monthBeforeYear: true\r\n                };\r\n\r\n                for (let i = 0; i < 7; i++) {\r\n                    data.formatLocale.weekdays.push(BX.message('DAY_OF_WEEK_' + i));\r\n                    data.formatLocale.weekdaysShort.push(BX.message('DOW_' + i));\r\n                    data.formatLocale.weekdaysMin.push(BX.message('DOW_' + i));\r\n                }\r\n\r\n                for (let i = 1; i <= 12; i++) {\r\n                    data.formatLocale.months.push(BX.message('MONTH_' + i));\r\n                    data.formatLocale.monthsShort.push(BX.message('MON_' + i));\r\n                }\r\n\r\n\r\n                return data;\r\n            },\r\n\r\n            timePickerOptions() {\r\n                return {\r\n                    start: this.config.timeStart ? this.config.timeStart : '00:00',\r\n                    end: this.config.timeEnd ? this.config.timeEnd : '23:45',\r\n                    step: this.config.step ? this.config.step : '00:15',\r\n                    format: 'HH:mm'\r\n                }\r\n            },\r\n        },\r\n        methods: {\r\n            updatePosition() {\r\n                let elRect = this.$el.querySelector('input').getBoundingClientRect();\r\n\r\n                this.popupStyle.top = (window.scrollY + elRect.y + elRect.height) + 'px';\r\n                this.popupStyle.left = window.scrollX + elRect.x + 'px';\r\n            },\r\n\r\n            onOpen() {\r\n                /*\r\n                this.updatePosition();\r\n\r\n                if (!this.timer)\r\n                {\r\n                    this.timer = setInterval(BX.delegate(this.updatePosition, this), 100);\r\n                }*/\r\n            },\r\n\r\n            onClose() {\r\n                //clearInterval(this.timer);\r\n            },\r\n\r\n            checkErrors() {\r\n                return this.checkRuleErrors();\r\n            },\r\n\r\n            setFocus() {\r\n                this.$children[0].focus();\r\n            },\r\n        },\r\n        template: `\r\n    <div class=\"devbx-webform-field\" :class=\"{'devbx-webform-required': required, 'devbx-webform--is-error': errorMessage.length}\">\r\n        <span class=\"devbx-webform-label\" v-html=\"formLabelFormatted\" v-if=\"!config.labelHidden\">\r\n        </span>\r\n\r\n        <date-picker \r\n            v-model:value=\"value\" \r\n            value-type=\"timestamp\"\r\n            :type=\"dateType\" \r\n            :placeholder=\"config.placeholder\"\r\n            :format=\"dateFormat\"\r\n            :time-picker-options=\"timePickerOptions\"\r\n            :disabled=\"readonly\"\r\n            @open=\"onOpen\"\r\n            @close=\"onClose\"\r\n            :lang=\"locale\"\r\n            popup-class=\"devbx-webform-theme\"\r\n            >\r\n        </date-picker>\r\n\r\n        <div class=\"devbx-webform-helptext\" v-if=\"helpTextFormatted.length>0\" v-html=\"helpTextFormatted\"></div>\r\n\r\n        <transition name=\"devbx-webform-field\">\r\n            <div class=\"devbx-webform-error-message\" v-if=\"errorMessage\" v-html=\"errorMessage\"></div>\r\n        </transition>\r\n    </div>    \r\n    `\r\n    });\r\n});"],"names":["props","data","mounted","item","component","unmounted","computed","labelFormatted","$root","htmlFormatFields","BX","util","htmlspecialchars","config","label","formLabelFormatted","required","helpTextFormatted","helpText","id","$","uid","readonly","formReadonly","checkCondition","hasCustomError","errorMessage","get","set","value","methods","checkRequired","validation","field","console","error","undefined","length","formatString","$Bitrix","Loc","getMessage","checkCustomError","customError","checkRuleErrors","addCustomEvent","app","DatePicker","install","mixins","fieldMixin","popupStyle","timer","formFieldByName","fieldName","i","parseInt","isNaN","type","Date","getTime","d","getHours","getMinutes","getSeconds","Math","floor","changed","checkPageErrors","dateType","toLowerCase","dateFormat","message","replaceAll","slice","locale","formatLocale","months","monthsShort","weekdays","weekdaysShort","weekdaysMin","firstDayOfWeek","firstWeekContainsDate","yearFormat","monthFormat","monthBeforeYear","push","timePickerOptions","start","timeStart","end","timeEnd","step","format","updatePosition","elRect","$el","querySelector","getBoundingClientRect","top","window","scrollY","y","height","left","scrollX","x","onOpen","onClose","checkErrors","setFocus","$children","focus","template"],"mappings":"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"}