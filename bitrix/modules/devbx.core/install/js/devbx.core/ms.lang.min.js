this.DevBX=this.DevBX||{};(function(exports){"use strict";var LexerType={ltNotSet:0,ltStartCode:1,ltEndCode:2,ltCompare:3,ltColon:4,ltSemicolon:5,ltLPar:6,ltRPar:7,ltPlus:8,ltMinus:9,ltDiv:10,ltMul:11,ltMod:12,ltBitAnd:13,ltAssign:14,ltNameSpace:15,ltNumeric:16,ltFloat:17,ltIDStr:18,ltObjProp:19,ltIF:20,ltELSE:21,ltComma:22,ltCompareAnd:23,ltCompareOr:24,ltString:25,ltSwitch:26,ltCase:27,ltBreak:28,ltFor:29,ltWhile:30,ltEof:31,ltShortIncrement:32,ltShortDecrement:33,ltNegativeIf:34};var FullTokenInfo=function FullTokenInfo(){babelHelpers.classCallCheck(this,FullTokenInfo)};var LexerTypeArray=function(_Array){babelHelpers.inherits(LexerTypeArray,_Array);function LexerTypeArray(){babelHelpers.classCallCheck(this,LexerTypeArray);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(LexerTypeArray).apply(this,arguments))}babelHelpers.createClass(LexerTypeArray,[{key:"cloneAdd",value:function cloneAdd(value){var r=new LexerTypeArray;r.push.apply(r,babelHelpers.toConsumableArray(this));if(Array.isArray(value)){r.push.apply(r,babelHelpers.toConsumableArray(value))}else{r.push(value)}return r}},{key:"asNames",get:function get(){var result=[],k=Object.keys(LexerType),v=Object.values(LexerType);this.forEach(function(value){var idx=v.indexOf(value);if(idx===-1)throw new Error("Unknown LexerType "+value);result.push(k[idx])});return result}}],[{key:"one",value:function one(value){var r=new LexerTypeArray;r.push(value);return r}}]);return LexerTypeArray}(babelHelpers.wrapNativeSuper(Array));var Lexer=function(){function Lexer(text){babelHelpers.classCallCheck(this,Lexer);babelHelpers.defineProperty(this,"_textPos",0);babelHelpers.defineProperty(this,"_cursorLine",1);babelHelpers.defineProperty(this,"_cursorCol",1);if(typeof text!=="string")throw new Error("text is not string");this._text=text}babelHelpers.createClass(Lexer,[{key:"getCh",value:function getCh(){this._lastCursorLine=this.cursorLine;this._lastCursorCol=this.cursorCol;this._lastChar=this._text.charAt(this._textPos);if(this._lastChar===""){this._lastChar=false}else{if(this._lastChar==="\n"){this._cursorLine++;this._cursorCol=1}else{this._cursorCol++}this._textPos++}return this._lastChar}},{key:"whoNextCh",value:function whoNextCh(){var ch=this._text.charAt(this._textPos);if(ch==="")return false;return ch}},{key:"isLetter",value:function isLetter(ch){if(ch===false)return false;var n=ch.charCodeAt(0);return n>=65&&n<91||n>=97&&n<123}},{key:"isLetterOrDigit",value:function isLetterOrDigit(ch){if(ch===false)return false;var n=ch.charCodeAt(0);return n>=65&&n<91||n>=97&&n<123||n>=48&&n<=57}},{key:"isDigit",value:function isDigit(ch){if(ch===false)return false;var n=ch.charCodeAt(0);return n>=48&&n<=57}},{key:"textPos",get:function get(){return this._textPos}},{key:"lastChar",get:function get(){return this._lastChar}},{key:"lastCursorLine",get:function get(){return this._lastCursorLine}},{key:"lastCursorCol",get:function get(){return this._lastCursorCol}},{key:"cursorLine",get:function get(){return this._cursorLine}},{key:"cursorCol",get:function get(){return this._cursorCol}}]);return Lexer}();var TokenCursor=function TokenCursor(){babelHelpers.classCallCheck(this,TokenCursor);babelHelpers.defineProperty(this,"startCursorLine",false);babelHelpers.defineProperty(this,"startCursorCol",false);babelHelpers.defineProperty(this,"endCursorLine",false);babelHelpers.defineProperty(this,"endCursorCol",false)};var CodeLexer=function(_Lexer){babelHelpers.inherits(CodeLexer,_Lexer);function CodeLexer(text){var _this;babelHelpers.classCallCheck(this,CodeLexer);_this=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(CodeLexer).call(this,text));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(_this),"_tokenCursor",false);_this._lastChar=false;return _this}babelHelpers.createClass(CodeLexer,[{key:"indexOfAny",value:function indexOfAny(chars){var _this2=this;var fromPos=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var result=[];chars.forEach(function(ch){var i=_this2._text.indexOf(ch,fromPos);if(i>-1)result.push(i)});return result}},{key:"indexOfAnyFirst",value:function indexOfAnyFirst(chars){var fromPos=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var result=this.indexOfAny(chars,fromPos);if(!result.length)return-1;return Math.min.apply(Math,babelHelpers.toConsumableArray(result))}},{key:"getPCHValue",value:function getPCHValue(pch){throw new Error("Not applicable")}},{key:"getRealToken",value:function getRealToken(){switch(this._lastChar){case"{":this._tokenSym=LexerType.ltStartCode;return;case"}":this._tokenSym=LexerType.ltEndCode;return;case";":this._tokenSym=LexerType.ltSemicolon;return;case"(":this._tokenSym=LexerType.ltLPar;return;case")":this._tokenSym=LexerType.ltRPar;return;case"+":if(this.whoNextCh()==="+"){this.getCh();this._tokenSym=LexerType.ltShortIncrement}else{this._tokenSym=LexerType.ltPlus}return;case"-":if(this.whoNextCh()==="-"){this.getCh();this._tokenSym=LexerType.ltShortDecrement;return}else{this._tokenSym=LexerType.ltMinus;return}case"/":this._tokenSym=LexerType.ltDiv;return;case"*":this._tokenSym=LexerType.ltMul;return;case"%":this._tokenSym=LexerType.ltMod;return;case",":this._tokenSym=LexerType.ltComma;return}if(this._lastChar==="<"||this._lastChar===">"){this._tokenValue+=this._lastChar;if(this.whoNextCh()==="=")this._tokenValue+=this.getCh();this._tokenSym=LexerType.ltCompare;return}if(this._lastChar==="="){this._tokenValue+=this._lastChar;if(this.whoNextCh()==="="){this._tokenValue+=this.getCh();this._tokenSym=LexerType.ltCompare}else{this._tokenSym=LexerType.ltAssign}return}if(this.lastChar==="!"){this._tokenValue+=this.lastChar;if(this.whoNextCh()==="="){this._tokenValue+=this.getCh();this._tokenSym=LexerType.ltCompare;return}else{this._tokenSym=LexerType.ltNegativeIf;return}}if(this.lastChar===":"){if(this.whoNextCh()===":"){this.getCh();this._tokenValue="";this._tokenSym=LexerType.ltNameSpace;return}else{this._tokenValue="";this._tokenSym=LexerType.ltColon;return}}if(this.lastChar==="&"){if(this.whoNextCh()==="&"){this.getCh();this._tokenValue="";this._tokenSym=LexerType.ltCompareAnd}else{this._tokenValue="";this._tokenSym=LexerType.ltBitAnd}return}if(this.lastChar==="|"&&this.whoNextCh()==="|"){this.getCh();this._tokenValue="";this._tokenSym=LexerType.ltCompareOr;return}if(this.lastChar==='"'||this.lastChar==="'"){var strSym=this.lastChar;var strSpecSym={t:"\t",r:"\r",n:"\n","\\":"\\"};while(true){this.getCh();if(this.lastChar===false)throw new Error("unexpected end of file");if(this.lastChar==="\\"){if(this.whoNextCh()===strSym){this._tokenValue+=this.getCh();continue}if(strSpecSym.hasOwnProperty(this.whoNextCh())){this._tokenValue+=strSpecSym[this.getCh()];continue}}if(this.lastChar===strSym){this._tokenSym=LexerType.ltString;return}if(this.lastChar==="\r"||this.lastChar==="\n"){throw new Error("Invalid string")}this._tokenValue+=this.lastChar}}this._tokenValue+=this.lastChar;var allowStopChars=["{","}","(",")",";","-","+","*","/","=","<",">","\r","\n",":"," ",",","!"];if(this.isDigit(this.lastChar)||this.lastChar==="-"){while(true){if(this.isDigit(this.whoNextCh())){this._tokenValue+=this.getCh();continue}if(this.whoNextCh()==="."){this._tokenValue+=this.getCh();this.isFloat=true;continue}if(allowStopChars.indexOf(this.whoNextCh())!==-1||this.whoNextCh()===false){if(this.isFloat)this._tokenSym=LexerType.ltFloat;else this._tokenSym=LexerType.ltNumeric;return}throw new Error("Parse numeric failed "+this.whoNextCh())}}if(this.lastChar==="@"){while(true){if(this.isLetterOrDigit(this.whoNextCh())||this.whoNextCh()==="_"){this._tokenValue+=this.getCh();continue}this._tokenValue=this.getPCHValue(this._tokenValue);this._tokenSym=LexerType.ltNumeric;return}}if(!this.isLetter(this.lastChar)&&this.lastChar!=="."){throw new Error("Parse failed")}var isObjProp=this._tokenValue===".";if(isObjProp)this._tokenValue="";while(true){if(this.isLetterOrDigit(this.whoNextCh())||this.whoNextCh()==="_"){this._tokenValue+=this.getCh();continue}if(this.whoNextCh()==="."){break}if(allowStopChars.indexOf(this.whoNextCh())!==-1){break}throw new Error("Parse IDStr failed")}if(isObjProp&&this._tokenValue[this._tokenValue.length-1]==="."){throw new Error("Invalid object property")}if(this._tokenValue==="if"){this._tokenSym=LexerType.ltIF;return}if(this._tokenValue==="else"){this._tokenSym=LexerType.ltELSE;return}if(this._tokenValue==="switch"){this._tokenSym=LexerType.ltSwitch;return}if(this._tokenValue==="case"){this._tokenSym=LexerType.ltCase;return}if(this._tokenValue==="break"){this._tokenSym=LexerType.ltBreak;return}if(this._tokenValue==="for"){this._tokenSym=LexerType.ltFor;return}if(this._tokenValue==="while"){this._tokenSym=LexerType.ltWhile;return}if(isObjProp){this._tokenSym=LexerType.ltObjProp}else{this._tokenSym=LexerType.ltIDStr}}},{key:"getToken",value:function getToken(){this._tokenCursor=false;this._tokenValue="";while(true){this.getCh();if(this.lastChar===false){this._tokenSym=LexerType.ltEof;return}if(this.lastChar===" "||this.lastChar==="\r"||this.lastChar==="\n"||this.lastChar==="\t")continue;if(this.lastChar==="/"&&this.whoNextCh()==="/"){var pos=this.indexOfAnyFirst(["\r","\n"],this._textPos);if(pos===-1)throw new Error("end of file");this._textPos=pos;continue}break}var tokenCursor=new TokenCursor;tokenCursor.startCursorLine=this.lastCursorLine;tokenCursor.startCursorCol=this.lastCursorCol;this.getRealToken();tokenCursor.endCursorLine=this.lastCursorLine;tokenCursor.endCursorCol=this.lastCursorCol;this._tokenCursor=tokenCursor}},{key:"getFullToken",value:function getFullToken(){this.getToken();var info=new FullTokenInfo;info.tokenValue=this._tokenValue;info.lastChar=this._lastChar;info.tokenSym=this._tokenSym;return info}},{key:"tokenCursor",get:function get(){return this._tokenCursor}},{key:"tokenValue",get:function get(){return this._tokenValue}},{key:"lastChar",get:function get(){return this._lastChar}},{key:"tokenSym",get:function get(){return this._tokenSym}},{key:"tokenName",get:function get(){var idx=Object.values(LexerType).indexOf(this._tokenSym);if(idx===-1)return"Unknown";return Object.keys(LexerType)[idx]}}]);return CodeLexer}(Lexer);var CompareType={ctEqual:1,ctNotEqual:2,ctLess:4,ctGreat:8};var NodeType={ntNotSet:0,ntAssign:1,ntPlus:2,ntMinus:3,ntDiv:4,ntMul:5,ntMod:6,ntBitAnd:7,ntObjProp:8,ntNumeric:9,ntFloat:10,ntString:11,ntSubExpression:12,ntFuncNameSpaceCall:13,ntFuncCall:14,ntFuncParam:15,ntShiftSP:16,ntIF:17,ntELSE:18,ntIFValue:19,ntIFValueBOOL:20,ntCompare:21,ntCompareAnd:22,ntCompareOr:23,ntSubCode:24,ntReturn:25,ntSuper:26,ntSwitch:27,ntCase:28,ntBreak:29,ntFor:30,ntForCompare:31,ntWhile:32,ntShortIncrement:33,ntShortDecrement:34,ntExpressionCompare:35,ntExpressionAssign:36,ntNegativeIf:37,ntSelfFuncCall:38,ntContextVariable:39};var ParseNode=function(){function ParseNode(){var cursorPos=arguments.length>0&&arguments[0]!==undefined?arguments[0]:undefined;var nType=arguments.length>1&&arguments[1]!==undefined?arguments[1]:undefined;var nValue=arguments.length>2&&arguments[2]!==undefined?arguments[2]:undefined;babelHelpers.classCallCheck(this,ParseNode);babelHelpers.defineProperty(this,"_nType",NodeType.ntNotSet);this._cursorPos=cursorPos;if(nType!==undefined){this._nType=nType;this.nValue=nValue}}babelHelpers.createClass(ParseNode,[{key:"isMathNode",value:function isMathNode(){switch(this.nType){case NodeType.ntPlus:case NodeType.ntMinus:case NodeType.ntMul:case NodeType.ntDiv:case NodeType.ntMod:case NodeType.ntBitAnd:return true}return false}},{key:"isCompareOrAndNode",value:function isCompareOrAndNode(){return this.nType===NodeType.ntCompareOr||this.nType===NodeType.ntCompareAnd}},{key:"cursorPos",get:function get(){return this._cursorPos}},{key:"nType",get:function get(){return this._nType},set:function set(value){if(value===undefined)throw new Error("Set undefined nType");this._nType=value}},{key:"nValue",get:function get(){return this._nValue},set:function set(value){this._nValue=value}},{key:"nValue2",get:function get(){return this._nValue2},set:function set(value){this._nValue2=value}},{key:"typeName",get:function get(){var k=Object.keys(NodeType),v=Object.values(NodeType);return k[v.indexOf(this.nType)]}}]);return ParseNode}();var CodeParser=function(){function CodeParser(lexer){babelHelpers.classCallCheck(this,CodeParser);this.lexer=lexer}babelHelpers.createClass(CodeParser,[{key:"destroy",value:function destroy(){this.lexer=false}},{key:"parseCompareToken",value:function parseCompareToken(str){if(str==="!=")return CompareType.ctNotEqual;if(str==="==")return CompareType.ctEqual;if(str===">=")return CompareType.ctGreat|CompareType.ctEqual;if(str==="<=")return CompareType.ctLess|CompareType.ctEqual;if(str===">")return CompareType.ctGreat;if(str==="<")return CompareType.ctLess;throw new Error("Unknown compare token")}},{key:"parseExpression",value:function parseExpression(Node,getFirstToken,StopLex){var NodeList=[];var getNextToken=getFirstToken;while(true){if(getNextToken)this.lexer.getToken();getNextToken=true;if(StopLex.indexOf(this.lexer.tokenSym)!==-1)break;var SubNode=null,prevNode=NodeList.length?NodeList[NodeList.length-1]:null;switch(this.lexer.tokenSym){case LexerType.ltPlus:SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntPlus);NodeList.push(SubNode);break;case LexerType.ltMinus:SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntMinus);NodeList.push(SubNode);break;case LexerType.ltMul:if(!prevNode||prevNode.isMathNode()||prevNode.isCompareOrAndNode())throw new Error("Invalid mul operator");SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntMul);NodeList.push(SubNode);break;case LexerType.ltDiv:if(!prevNode||prevNode.isMathNode()||prevNode.isCompareOrAndNode())throw new Error("Invalid div operator");SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntDiv);NodeList.push(SubNode);break;case LexerType.ltMod:if(!prevNode||prevNode.isMathNode()||prevNode.isCompareOrAndNode())throw new Error("Invalid mod operator");SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntMod);NodeList.push(SubNode);break;case LexerType.ltBitAnd:if(!prevNode||prevNode.isMathNode()||prevNode.isCompareOrAndNode())throw new Error("Invalid BitAnd operator");SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntBitAnd);NodeList.push(SubNode);break;case LexerType.ltObjProp:SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntObjProp,this.lexer.tokenValue);NodeList.push(SubNode);break;case LexerType.ltNumeric:if(prevNode&&!prevNode.isMathNode()&&!prevNode.isCompareOrAndNode())throw new Error("Parse expression failed");SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntNumeric,parseInt(this.lexer.tokenValue));if(isNaN(SubNode.nValue))throw new Error("Failed parse integer value "+this.lexer.tokenValue);NodeList.push(SubNode);break;case LexerType.ltFloat:if(prevNode&&!prevNode.isMathNode())throw new Error("Parse expression failed");SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntFloat,parseFloat(this.lexer.tokenValue));if(isNaN(SubNode.nValue))throw new Error("Failed parse float value "+this.lexer.tokenValue);NodeList.push(SubNode);break;case LexerType.ltString:if(prevNode&&prevNode.nType!==NodeType.ntPlus)throw new Error("Parse string expression failed");SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntString,this.lexer.tokenValue);NodeList.push(SubNode);break;case LexerType.ltIDStr:SubNode=new ParseNode(this.lexer.tokenCursor);var saveToken=this.lexer.tokenValue;this.lexer.getToken();if(this.lexer.tokenSym!==LexerType.ltNameSpace){if(this.lexer.tokenSym===LexerType.ltAssign){SubNode.nType=NodeType.ntExpressionAssign;SubNode.nValue=saveToken;this.parseExpression(SubNode,true,StopLex);getNextToken=false}else{SubNode.nType=NodeType.ntContextVariable;SubNode.nValue=saveToken;getNextToken=false}}else{SubNode.nType=NodeType.ntFuncNameSpaceCall;SubNode.nValue=saveToken;this.parseFunction(SubNode)}NodeList.push(SubNode);break;case LexerType.ltLPar:if(prevNode&&prevNode.nType===NodeType.ntObjProp){SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntSelfFuncCall,prevNode.nValue);NodeList.pop();this.parseFunctionParams(SubNode);NodeList.push(SubNode);break}if(prevNode&&prevNode.nType===NodeType.ntContextVariable){SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntFuncCall,prevNode.nValue);NodeList.pop();this.parseFunctionParams(SubNode);NodeList.push(SubNode);break}if(prevNode&&!prevNode.isMathNode()&&!prevNode.isCompareOrAndNode())throw new Error("Parse expression failed");SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntSubExpression);this.parseExpression(SubNode,true,LexerTypeArray.one(LexerType.ltRPar));NodeList.push(SubNode);break;case LexerType.ltAssign:throw new Error("Expression is assign");break;case LexerType.ltCompare:SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntExpressionCompare);SubNode.nValue=this.parseCompareToken(this.lexer.tokenValue);NodeList.push(SubNode);SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntIFValue);this.parseExpression(SubNode,true,babelHelpers.construct(LexerTypeArray,babelHelpers.toConsumableArray(StopLex).concat([LexerType.ltCompareAnd,LexerType.ltCompareOr])));NodeList.push(SubNode);getNextToken=false;break;case LexerType.ltCompareAnd:if(prevNode&&prevNode.isCompareOrAndNode())throw new Error("Invalid token");SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntCompareAnd);NodeList.push(SubNode);break;case LexerType.ltCompareOr:if(prevNode&&prevNode.isCompareOrAndNode())throw new Error("Invalid token");SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntCompareOr);NodeList.push(SubNode);break;case LexerType.ltNegativeIf:SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntNegativeIf);NodeList.push(SubNode);break;case LexerType.ltShortIncrement:SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntShortIncrement);NodeList.push(SubNode);break;case LexerType.ltShortDecrement:SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntShortDecrement);NodeList.push(SubNode);break;default:throw new Error("Parse lexer expression failed "+this.lexer.tokenName+" wait "+StopLex.asNames.join(", "))}}if(!NodeList.length)throw new Error("Failed parse expression");var lastNode=NodeList[NodeList.length-1];if(lastNode.isMathNode()||lastNode.isCompareOrAndNode())throw new Error("Failed parse expression");var idx=0,leftIdx=0,rightIdx,node;while(idx<NodeList.length-1){node=NodeList[idx];if(node.isMathNode()){if(node.nType!==NodeType.ntMul&&node.nType!==NodeType.ntDiv){idx++;leftIdx=idx;idx++;continue}rightIdx=idx+1;while(rightIdx<NodeList.length-2){if(NodeList[rightIdx+1].isMathNode()||NodeList[rightIdx+1].isCompareOrAndNode())break;rightIdx++}var _SubNode=new ParseNode(NodeList[idx].cursorPos,NodeType.ntSubExpression);_SubNode.childItems=NodeList.slice(leftIdx,rightIdx+1);NodeList.splice(leftIdx,rightIdx-leftIdx+1,_SubNode);idx=leftIdx}idx++}Node.childItems=NodeList}},{key:"parseAssign",value:function parseAssign(Node,EndLineType){if(!(Node instanceof ParseNode))throw new Error("Node must be instanceof ParseNode");if(!(EndLineType instanceof LexerTypeArray))throw new Error("EndLineType must be instanceof LexerTypeArray");this.parseExpression(Node,true,EndLineType)}},{key:"parseFunction",value:function parseFunction(Node){if(!(Node instanceof ParseNode))throw new Error("Node must be instanceof ParseNode");this.lexer.getToken();if(this.lexer.tokenSym!==LexerType.ltIDStr)throw new Error("function name not defined");Node.nValue2=this.lexer.tokenValue;this.lexer.getToken();if(this.lexer.tokenSym!==LexerType.ltLPar)throw new Error("function LPar not found");var NodeList=[];while(true){this.lexer.getToken();if(this.lexer.tokenSym===LexerType.ltRPar)break;var SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntFuncParam);this.parseExpression(SubNode,false,new LexerTypeArray(LexerType.ltComma,LexerType.ltRPar));NodeList.push(SubNode);if(this.lexer.tokenSym===LexerType.ltRPar)break}Node.childItems=NodeList}},{key:"parseFunctionParams",value:function parseFunctionParams(Node){if(!(Node instanceof ParseNode))throw new Error("Node must be instanceof ParseNode");var NodeList=[];while(true){this.lexer.getToken();if(this.lexer.tokenSym===LexerType.ltRPar)break;var SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntFuncParam);this.parseExpression(SubNode,false,new LexerTypeArray(LexerType.ltComma,LexerType.ltRPar));NodeList.push(SubNode);if(this.lexer.tokenSym===LexerType.ltRPar)break}Node.childItems=NodeList}},{key:"parseCompare",value:function parseCompare(Node,EndCompareType){if(!(Node instanceof ParseNode))throw new Error("Node must be instanceof ParseNode");var NodeList=[];while(true){this.lexer.getToken();if(this.lexer.tokenSym===EndCompareType)break;var SubNode=void 0;if(this.lexer.tokenSym===LexerType.ltLPar){SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntSubExpression);this.parseCompare(SubNode,LexerType.ltRPar);if(!SubNode.childItems.length){throw new Error("Expression is empty")}NodeList.push(SubNode);this.lexer.getToken();if(this.lexer.tokenSym===EndCompareType)break;if(this.lexer.tokenSym===LexerType.ltCompareAnd){SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntCompareAnd);NodeList.push(SubNode);continue}if(this.lexer.tokenSym===LexerType.ltCompareOr){SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntCompareOr);NodeList.push(SubNode);continue}if(this.lexer.tokenSym===LexerType.ltCompare){SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntCompare);SubNode.nValue=this.parseCompareToken(this.lexer.tokenValue);NodeList.push(SubNode);SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntIFValue);this.parseExpression(SubNode,true,new LexerTypeArray(EndCompareType,LexerType.ltCompareAnd,LexerType.ltCompareOr));NodeList.push(SubNode);if(this.lexer.tokenSym===EndCompareType)break;continue}throw new Error("Parse IF failed")}SubNode=new ParseNode(this.lexer.tokenCursor);this.parseExpression(SubNode,false,new LexerTypeArray(LexerType.ltCompare,LexerType.ltRPar,LexerType.ltCompareAnd,LexerType.ltCompareOr));NodeList.push(SubNode);if(this.lexer.tokenSym===LexerType.ltCompare){SubNode.nType=NodeType.ntIFValue;SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntCompare);SubNode.nValue=this.parseCompareToken(this.lexer.tokenValue);NodeList.push(SubNode);SubNode=new ParseNode(this.lexer.tokenCursor,NodeType.ntIFValue);this.parseExpression(SubNode,true,new LexerTypeArray(EndCompareType,LexerType.ltCompareAnd,LexerType.ltCompareOr));NodeList.push(SubNode)}else{SubNode.nType=NodeType.ntIFValueBOOL}if(this.lexer.tokenSym===EndCompareType)break;SubNode=new ParseNode(this.lexer.tokenCursor);if(this.lexer.tokenSym===LexerType.ltCompareAnd)SubNode.nType=NodeType.ntCompareAnd;else if(this.lexer.tokenSym===LexerType.ltCompareOr)SubNode.nType=NodeType.ntCompareOr;else throw new Error("Parse IF failed");NodeList.push(SubNode)}Node.childItems=NodeList}},{key:"parseCode",value:function parseCode(NodeList,getFirstToken,inline,endLineType){var getNextToken=false;if(!Array.isArray(NodeList))throw new Error("NodeList must be array");if(typeof getFirstToken!=="boolean")throw new Error("getFirstToken must be boolean");if(typeof inline!=="boolean")throw new Error("inline must be boolean");if(!(endLineType instanceof LexerTypeArray))throw new Error("endLineType must be LexerTypeArray");if(!inline){if(getFirstToken)this.lexer.getToken()}else{getNextToken=getFirstToken}while(true){if(getNextToken)this.lexer.getToken();if(endLineType.indexOf(this.lexer.tokenSym)!==-1)return;getNextToken=true;if(this.lexer.tokenSym===LexerType.ltIDStr&&this.lexer.tokenValue==="return"){var Node=new ParseNode(this.lexer.tokenCursor,NodeType.ntReturn);NodeList.push(Node);if(inline){this.parseExpression(Node,true,endLineType.cloneAdd(LexerType.ltSemicolon))}else{this.parseExpression(Node,true,LexerTypeArray.one(LexerType.ltSemicolon))}continue}if(this.lexer.tokenSym===LexerType.ltIDStr){var _Node=new ParseNode(this.lexer.tokenCursor,NodeType.ntNotSet);if(inline)this.parseExpression(_Node,false,endLineType.cloneAdd(LexerType.ltSemicolon));else this.parseExpression(_Node,false,LexerTypeArray.one(LexerType.ltSemicolon));NodeList.push.apply(NodeList,babelHelpers.toConsumableArray(_Node.childItems));_Node=new ParseNode(this.lexer.tokenCursor,NodeType.ntShiftSP,-1);NodeList.push(_Node)}else{var _Node2=void 0,Node2=void 0;switch(this.lexer.tokenSym){case LexerType.ltSwitch:throw new Error("Switch not implemented");break;case LexerType.ltFor:_Node2=new ParseNode(this.lexer.tokenCursor,NodeType.ntFor);_Node2.childItems=[];NodeList.push(_Node2);this.lexer.getToken();if(this.lexer.tokenSym!==LexerType.ltLPar)throw new Error("Parse FOR failed");Node2=new ParseNode(this.lexer.tokenCursor,NodeType.ntSubCode);Node2.childItems=[];_Node2.childItems.push(Node2);this.parseCode(Node2.childItems,true,true,LexerTypeArray.one(LexerType.ltSemicolon));Node2=new ParseNode(this.lexer.tokenCursor,NodeType.ntForCompare);_Node2.childItems.push(Node2);this.parseCompare(Node2,LexerType.ltSemicolon);Node2=new ParseNode(this.lexer.tokenCursor,NodeType.ntSubCode);Node2.childItems=[];_Node2.childItems.push(Node2);this.parseCode(Node2.childItems,true,true,LexerTypeArray.one(LexerType.ltRPar));if(this.lexer.tokenSym!==LexerType.ltRPar)throw new Error("Parse FOR failed");this.lexer.getToken();Node2=new ParseNode(this.lexer.tokenCursor,NodeType.ntSubCode);Node2.childItems=[];if(this.lexer.tokenSym===LexerType.ltStartCode){this.parseCode(Node2.childItems,true,false,LexerTypeArray.one(LexerType.ltEndCode))}else{this.parseCode(Node2.childItems,false,true,LexerTypeArray.one(LexerType.ltSemicolon))}_Node2.childItems.push(Node2);break;case LexerType.ltWhile:_Node2=new ParseNode(this.lexer.tokenCursor,NodeType.ntWhile);NodeList.push(_Node2);this.lexer.getToken();if(this.lexer.tokenSym!==LexerType.ltLPar)throw new Error("operator if LPar not found");this.parseCompare(_Node2,LexerType.ltRPar);_Node2=new ParseNode(this.lexer.tokenCursor,NodeType.ntSubCode);_Node2.childItems=[];NodeList.push(_Node2);this.lexer.getToken();if(this.lexer.tokenSym===LexerType.ltStartCode){this.parseCode(_Node2.childItems,true,false,LexerTypeArray.one(LexerType.ltEndCode))}else{this.parseCode(_Node2.childItems,false,true,LexerTypeArray.one(LexerType.ltSemicolon))}break;case LexerType.ltBreak:_Node2=new ParseNode(this.lexer.tokenCursor,NodeType.ntBreak);NodeList.push(_Node2);this.lexer.getToken();if(this.lexer.tokenSym!==LexerType.ltSemicolon)throw new Error("Parse break failed");break;case LexerType.ltIF:_Node2=new ParseNode(this.lexer.tokenCursor,NodeType.ntIF);NodeList.push(_Node2);this.lexer.getToken();if(this.lexer.tokenSym!==LexerType.ltLPar)throw new Error("operator if LPar not found");this.parseCompare(_Node2,LexerType.ltRPar);if(!_Node2.childItems.length)throw new Error("Expression is empty");_Node2=new ParseNode(this.lexer.tokenCursor,NodeType.ntSubCode);_Node2.childItems=[];NodeList.push(_Node2);this.lexer.getToken();if(this.lexer.tokenSym===LexerType.ltStartCode){this.parseCode(_Node2.childItems,true,false,LexerTypeArray.one(LexerType.ltEndCode))}else{this.parseCode(_Node2.childItems,false,true,LexerTypeArray.one(LexerType.ltSemicolon))}this.lexer.getToken();if(this.lexer.tokenSym!==LexerType.ltELSE){getNextToken=false;break}_Node2=new ParseNode(this.lexer.tokenCursor,NodeType.ntELSE);NodeList.push(_Node2);_Node2=new ParseNode(this.lexer.tokenCursor,NodeType.ntSubCode);_Node2.childItems=[];NodeList.push(_Node2);this.lexer.getToken();if(this.lexer.tokenSym===LexerType.ltStartCode){this.parseCode(_Node2.childItems,true,false,LexerTypeArray.one(LexerType.ltEndCode))}else{this.parseCode(_Node2.childItems,false,true,LexerTypeArray.one(LexerType.ltSemicolon))}break;case LexerType.ltStartCode:_Node2=new ParseNode(this.lexer.tokenCursor,NodeType.ntSubCode);_Node2.childItems=[];NodeList.push(_Node2);this.parseCode(_Node2.childItems,true,false,LexerTypeArray.one(LexerType.ltEndCode));break;case LexerType.ltSemicolon:break;default:throw new Error("Failed parse code, tokenSym: "+this.lexer.tokenName)}}if(inline&&endLineType.indexOf(this.lexer.tokenSym)!==-1)return}throw new Error("WTF")}}]);return CodeParser}();var VariableType={vtUndefined:0,vtVoid:1,vtNull:2,vtInteger:3,vtFloat:3,vtNumber:3,vtString:5,vtBoolean:6,vtArray:7,vtObject:8,vtFunction:9};var StackVariable=function(){function StackVariable(type,isConst){babelHelpers.classCallCheck(this,StackVariable);babelHelpers.defineProperty(this,"properties",{});this._type=type;this._value=undefined;this._isConst=isConst}babelHelpers.createClass(StackVariable,[{key:"getProperty",value:function getProperty(name){if(!this.properties[name])return undefined;if(typeof this.properties[name].get!=="function")return undefined;return this.properties[name].get()}},{key:"comparePriority",value:function comparePriority(variable,compareType){if(compareType!==CompareType.ctEqual&&compareType!==CompareType.ctNotEqual)return false;return 0}},{key:"compare",value:function compare(variable,compareType){switch(compareType){case CompareType.ctEqual:return this.value==variable.value;case CompareType.ctNotEqual:return this.value!=variable.value}throw new Error("Invalid compare type")}},{key:"isNumeric",get:function get(){return this.type===VariableType.vtInteger||this.type===VariableType.vtFloat||this.type===VariableType.vtNumber}},{key:"type",get:function get(){return this._type}},{key:"typeName",get:function get(){var idx=Object.values(VariableType).indexOf(this._type);if(idx<0)return"???";return Object.keys(VariableType)[idx].substring(2).toLowerCase()}},{key:"value",get:function get(){return this._value},set:function set(value){throw new Error("value is read only")}},{key:"isConst",get:function get(){return this._isConst}},{key:"functions",get:function get(){return{}}}]);return StackVariable}();var StackVariableUndefined=function(_StackVariable){babelHelpers.inherits(StackVariableUndefined,_StackVariable);function StackVariableUndefined(isConst){var _this;babelHelpers.classCallCheck(this,StackVariableUndefined);_this=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(StackVariableUndefined).call(this,VariableType.vtUndefined,isConst));_this._value=undefined;return _this}return StackVariableUndefined}(StackVariable);var StackVariableNull=function(_StackVariable2){babelHelpers.inherits(StackVariableNull,_StackVariable2);function StackVariableNull(isConst){var _this2;babelHelpers.classCallCheck(this,StackVariableNull);_this2=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(StackVariableNull).call(this,VariableType.vtNull,isConst));_this2._value=null;return _this2}return StackVariableNull}(StackVariable);var StackVariableNumber=function(_StackVariable3){babelHelpers.inherits(StackVariableNumber,_StackVariable3);function StackVariableNumber(isConst,value){var _this3;babelHelpers.classCallCheck(this,StackVariableNumber);_this3=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(StackVariableNumber).call(this,VariableType.vtNumber,isConst));_this3.value=value;return _this3}babelHelpers.createClass(StackVariableNumber,[{key:"comparePriority",value:function comparePriority(variable,compareType){if(variable.isNumeric)return 1;if(compareType!==CompareType.ctEqual&&compareType!==CompareType.ctNotEqual)return false;return 0}},{key:"compare",value:function compare(variable,compareType){switch(compareType){case CompareType.ctEqual:return this.value==variable.value;case CompareType.ctNotEqual:return this.value!=variable.value}if(!variable.isNumeric)throw new Error("Invalid compare type");switch(compareType){case CompareType.ctLess:return this.value<variable.value;case CompareType.ctGreat:return this.value>variable.value;case CompareType.ctEqual|CompareType.ctLess:return this.value<=variable.value;case CompareType.ctEqual|CompareType.ctGreat:return this.value>=variable.value;default:throw new Error("Unknown compare type "+compareType)}}},{key:"value",get:function get(){return this._value},set:function set(value){if(typeof value!=="number")throw new Error("variable type "+babelHelpers["typeof"](value)+" expected number");this._value=value}}]);return StackVariableNumber}(StackVariable);var StackVariableBoolean=function(_StackVariable4){babelHelpers.inherits(StackVariableBoolean,_StackVariable4);function StackVariableBoolean(isConst,value){var _this4;babelHelpers.classCallCheck(this,StackVariableBoolean);_this4=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(StackVariableBoolean).call(this,VariableType.vtBoolean,isConst));_this4.value=value;return _this4}babelHelpers.createClass(StackVariableBoolean,[{key:"value",get:function get(){return this._value},set:function set(value){if(typeof value!=="boolean")throw new Error("variable type "+babelHelpers["typeof"](value)+" expected boolean");this._value=value}}]);return StackVariableBoolean}(StackVariable);var StackVariableString=function(_StackVariable5){babelHelpers.inherits(StackVariableString,_StackVariable5);function StackVariableString(isConst,value){var _this5;babelHelpers.classCallCheck(this,StackVariableString);_this5=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(StackVariableString).call(this,VariableType.vtString,isConst));_this5.value=value;return _this5}babelHelpers.createClass(StackVariableString,[{key:"value",get:function get(){return this._value},set:function set(value){if(typeof value!=="string")throw new Error("variable type "+babelHelpers["typeof"](value)+" expected string");this._value=value}},{key:"functions",get:function get(){return{Contains:{arguments:[{name:"searchString",type:VariableType.vtString}],func:function func(self,searchString){return new StackVariableBoolean(false,self.value.indexOf(searchString)!==-1)}},StartsWith:{arguments:[{name:"searchString",type:VariableType.vtString}],func:function func(self,searchString){return new StackVariableBoolean(false,self.value.startsWith(searchString))}},EndsWith:{arguments:[{name:"searchString",type:VariableType.vtString}],func:function func(self,searchString){return new StackVariableBoolean(false,self.value.endsWith(searchString))}},ToUpper:{arguments:[],func:function func(self){return new StackVariableString(false,self.value.toUpperCase())}},ToLower:{arguments:[],func:function func(self){return new StackVariableString(false,self.value.toLowerCase())}},Length:{arguments:[],func:function func(self){return new StackVariableNumber(false,self.value.length)}},Trim:{arguments:[],func:function func(self){return new StackVariableString(false,self.value.trim())}},SubString:{arguments:[{name:"start",type:VariableType.vtNumber},{name:"end",type:VariableType.vtNumber,default:function _default(){return new StackVariableUndefined(true)}}],func:function func(self,start,end){return new StackVariableString(false,self.value.substring(start,end))}}}}}]);return StackVariableString}(StackVariable);var StackVariableArray=function(_StackVariable6){babelHelpers.inherits(StackVariableArray,_StackVariable6);function StackVariableArray(isConst,value){var _this6;babelHelpers.classCallCheck(this,StackVariableArray);_this6=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(StackVariableArray).call(this,VariableType.vtArray,isConst));_this6.value=value;return _this6}babelHelpers.createClass(StackVariableArray,[{key:"value",get:function get(){return this._value},set:function set(value){if(!Array.isArray(value))throw new Error("variable type "+babelHelpers["typeof"](value)+" expected array");this._value=value}},{key:"functions",get:function get(){return{Count:{arguments:[],func:function func(self){return new StackVariableNumber(false,self.value.length)}},Contains:{arguments:[{name:"searchValue",type:VariableType.vtString}],func:function func(self,searchValue){return new StackVariableBoolean(false,self.value.indexOf(searchValue)!==-1)}}}}}]);return StackVariableArray}(StackVariable);var StackVariableFunction=function(_StackVariable7){babelHelpers.inherits(StackVariableFunction,_StackVariable7);function StackVariableFunction(value,self){var _this7;babelHelpers.classCallCheck(this,StackVariableFunction);_this7=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(StackVariableFunction).call(this,VariableType.vtFunction,true));_this7._value=value;_this7._self=self;return _this7}babelHelpers.createClass(StackVariableFunction,[{key:"value",get:function get(){return this._value},set:function set(value){throw new Error("Cannot override functions")}},{key:"self",get:function get(){return this._self}}]);return StackVariableFunction}(StackVariable);var StackVariableObject=function(_StackVariable8){babelHelpers.inherits(StackVariableObject,_StackVariable8);function StackVariableObject(isConst,value){var _this8;babelHelpers.classCallCheck(this,StackVariableObject);_this8=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(StackVariableObject).call(this,VariableType.vtObject,isConst));_this8.value=value;return _this8}babelHelpers.createClass(StackVariableObject,[{key:"registerProperty",value:function registerProperty(name,variable){this._value[name]=variable}},{key:"getProperty",value:function getProperty(name){return this._value[name]}},{key:"value",get:function get(){return this._value},set:function set(value){this._value=value}}]);return StackVariableObject}(StackVariable);var InterpreterNodeType={ntAssignFinish:1e3,ntFuncCallFinish:1001,ntSubExpressionFinish:1002,ntFuncParamFinish:1003,ntIFFinish:1004,ntIFValueFinish:1005,ntIFValueBOOLFinish:1006,ntSubCodeFinish:1007,ntForLoop:1008,ntForCompareFinish:1009,ntReturnFinish:1010,ntExpressionAssignFinish:1011,ntSelfFuncCallFinish:1012};var InterpreterNode=function(_ParseNode){babelHelpers.inherits(InterpreterNode,_ParseNode);function InterpreterNode(){babelHelpers.classCallCheck(this,InterpreterNode);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(InterpreterNode).apply(this,arguments))}babelHelpers.createClass(InterpreterNode,[{key:"typeName",get:function get(){var k=Object.keys(InterpreterNodeType),v=Object.values(InterpreterNodeType);if(v.indexOf(this.nType)===-1){k=Object.keys(NodeType);v=Object.values(NodeType)}return k[v.indexOf(this.nType)]}}]);return InterpreterNode}(ParseNode);var Interpreter=function(){function Interpreter(){babelHelpers.classCallCheck(this,Interpreter);this._nodeHandler=[]}babelHelpers.createClass(Interpreter,[{key:"destroy",value:function destroy(){this._nodeHandler=false}},{key:"registerNodeHandler",value:function registerNodeHandler(nodeType,handler){if(nodeType===undefined)throw new Error("Undefined nodeType");this._nodeHandler[nodeType]=handler}},{key:"getCodeHandler",value:function getCodeHandler(nodeType){return this._nodeHandler[nodeType]}},{key:"registerHandlers",value:function registerHandlers(){var self=this;this.registerNodeHandler(NodeType.ntAssign,function(){self.assignHandler.apply(self,arguments)});this.registerNodeHandler(InterpreterNodeType.ntAssignFinish,function(){self.assignFinishHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntExpressionAssign,function(){self.expressionAssignHandler.apply(self,arguments)});this.registerNodeHandler(InterpreterNodeType.ntExpressionAssignFinish,function(){self.expressionAssignFinishHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntNumeric,function(){self.numericHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntFloat,function(){self.floatHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntString,function(){self.stringHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntPlus,function(){self.plusHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntMinus,function(){self.minusHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntMul,function(){self.mulHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntDiv,function(){self.divHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntShortIncrement,function(){self.shortIncrementHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntShortDecrement,function(){self.shortDecrementHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntSubExpression,function(){self.subExpressionHandler.apply(self,arguments)});this.registerNodeHandler(InterpreterNodeType.ntSubExpressionFinish,function(){self.subExpressionFinishHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntFuncCall,function(){self.funcCallHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntFuncNameSpaceCall,function(){self.funcCallHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntFuncParam,function(){self.funcParamHandler.apply(self,arguments)});this.registerNodeHandler(InterpreterNodeType.ntFuncParamFinish,function(){self.funcParamFinishHandler.apply(self,arguments)});this.registerNodeHandler(InterpreterNodeType.ntFuncCallFinish,function(){self.funcCallFinishHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntSelfFuncCall,function(){self.selfFuncCallHandler.apply(self,arguments)});this.registerNodeHandler(InterpreterNodeType.ntSelfFuncCallFinish,function(){self.selfFuncCallFinishHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntShiftSP,function(){self.shiftSPHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntObjProp,function(){self.objPropHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntContextVariable,function(){self.contextVariableHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntIF,function(){self.ifHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntIFValue,function(){self.ifValueHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntIFValueBOOL,function(){self.ifValueBOOLHandler.apply(self,arguments)});this.registerNodeHandler(InterpreterNodeType.ntIFValueFinish,function(){self.ifValueFinishHandler.apply(self,arguments)});this.registerNodeHandler(InterpreterNodeType.ntIFValueBOOLFinish,function(){self.ifValueBOOLFinishHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntExpressionCompare,function(){self.expressionCompareHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntCompare,function(){self.ifCompareHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntCompareOr,function(){self.ifCompareOrHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntCompareAnd,function(){self.ifCompareAndHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntNegativeIf,function(){self.negativeIfHandler.apply(self,arguments)});this.registerNodeHandler(InterpreterNodeType.ntIFFinish,function(){self.ifFinishHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntSubCode,function(){self.subCodeHandler.apply(self,arguments)});this.registerNodeHandler(InterpreterNodeType.ntSubCodeFinish,function(){self.subCodeFinishHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntELSE,function(){self.elseHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntFor,function(){self.forHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntForCompare,function(){self.forCompareHandler.apply(self,arguments)});this.registerNodeHandler(InterpreterNodeType.ntForCompareFinish,function(){self.forCompareFinishHandler.apply(self,arguments)});this.registerNodeHandler(InterpreterNodeType.ntForLoop,function(){self.forLoopHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntReturn,function(){self.returnHandler.apply(self,arguments)});this.registerNodeHandler(InterpreterNodeType.ntReturnFinish,function(){self.returnFinishHandler.apply(self,arguments)});this.registerNodeHandler(NodeType.ntBreak,function(){self.breakHandler.apply(self,arguments)})}},{key:"assignHandler",value:function assignHandler(context,token){var _context$_codeItems;if(!token.childItems.length)throw new Error("assign is empty");context.pushExecutionStack();context._codeItems=[];(_context$_codeItems=context._codeItems).push.apply(_context$_codeItems,babelHelpers.toConsumableArray(token.childItems));var node=new InterpreterNode;node.nType=InterpreterNodeType.ntAssignFinish;node.nValue=token.nValue;context._codeItems.push(node)}},{key:"assignFinishHandler",value:function assignFinishHandler(context,token){var variable=context.popStackVar();context.popExecutionStack(true);context.setVariable(token.nValue,context.createVariable(variable.type,variable._value))}},{key:"expressionAssignHandler",value:function expressionAssignHandler(context,token){var _context$_codeItems2;if(!token.childItems.length)throw new Error("assign is empty");context.pushExecutionStack();context._codeItems=[];(_context$_codeItems2=context._codeItems).push.apply(_context$_codeItems2,babelHelpers.toConsumableArray(token.childItems));var node=new InterpreterNode;node.nType=InterpreterNodeType.ntExpressionAssignFinish;node.nValue=token.nValue;context._codeItems.push(node)}},{key:"expressionAssignFinishHandler",value:function expressionAssignFinishHandler(context,token){var variable=context.popStackVar();context.popExecutionStack(true);var cloneVariable=context.createVariable(variable.type,variable.value);context.setVariable(token.nValue,cloneVariable);context.pushStackVar(cloneVariable)}},{key:"numericHandler",value:function numericHandler(context,token){var variable=context.createVariable(VariableType.vtInteger,token.nValue);context.pushStackVar(variable)}},{key:"floatHandler",value:function floatHandler(context,token){var variable=context.createVariable(VariableType.vtFloat,token.nValue);context.pushStackVar(variable)}},{key:"stringHandler",value:function stringHandler(context,token){var variable=context.createVariable(VariableType.vtString,token.nValue);context.pushStackVar(variable)}},{key:"plusHandler",value:function plusHandler(context,token){context.execGetVariable();var rightVar=context.popStackVar(),leftVar=context.popStackVar();var variable;if(leftVar.type===VariableType.vtString){variable=context.createVariable(VariableType.vtString,leftVar.value+rightVar.value.toString())}else{if(!rightVar.isNumeric||!leftVar.isNumeric){throw new Error("Invalid variable type ")}variable=context.createVariable(VariableType.vtNumber,leftVar.value+rightVar.value)}context.pushStackVar(variable)}},{key:"minusHandler",value:function minusHandler(context,token){context.execGetVariable();var rightVar=context.popStackVar(),variable;if(!rightVar.isNumeric){throw new Error("variable is not numeric")}if(!context._stackVars.length){variable=context.createVariable(rightVar.type,-rightVar.value);context.pushStackVar(variable);return}var leftVar=context.popStackVar();if(!leftVar.isNumeric){throw new Error("variable is not numeric")}variable=context.createVariable(VariableType.vtNumber,leftVar.value-rightVar.value);context.pushStackVar(variable)}},{key:"mulHandler",value:function mulHandler(context,token){context.execGetVariable();var rightVar=context.popStackVar(),leftVar=context.popStackVar();if(!leftVar.isNumeric||!rightVar.isNumeric){throw new Error("variable is not numeric")}var variable=context.createVariable(VariableType.vtNumber,leftVar.value*rightVar.value);context.pushStackVar(variable)}},{key:"divHandler",value:function divHandler(context,token){context.execGetVariable();var rightVar=context.popStackVar(),leftVar=context.popStackVar();if(!leftVar.isNumeric||!rightVar.isNumeric){throw new Error("variable is not numeric")}var variable=context.createVariable(VariableType.vtNumber,leftVar.value/rightVar.value);context.pushStackVar(variable)}},{key:"shortIncrementHandler",value:function shortIncrementHandler(context,token){if(context._stackVars.length){var variable=context.popStackVar();if(!variable.isNumeric){throw new Error("variable is not numeric")}var newVariable=context.createVariable(VariableType.vtNumber,variable.value);context.pushStackVar(newVariable);variable.value++}else{context.execGetVariable();var _variable=context.popStackVar();if(!_variable.isNumeric){throw new Error("variable is not numeric")}_variable.value++;context.pushStackVar(_variable)}}},{key:"shortDecrementHandler",value:function shortDecrementHandler(context,token){var variable=context.getVariable(token.nValue);if(!variable)throw new Error("Unknown variable "+token.nValue);if(!variable.isNumeric)throw new Error("Variable must be numeric");variable.value--}},{key:"subExpressionHandler",value:function subExpressionHandler(context,token){var _context$_codeItems3;if(!token.childItems.length)throw new Error("Sub expression is empty");context.pushExecutionStack();context._codeItems=[];(_context$_codeItems3=context._codeItems).push.apply(_context$_codeItems3,babelHelpers.toConsumableArray(token.childItems));var node=new InterpreterNode;node.nType=InterpreterNodeType.ntSubExpressionFinish;context._codeItems.push(node)}},{key:"subExpressionFinishHandler",value:function subExpressionFinishHandler(context,token){var variable=context.popStackVar();context.popExecutionStack();context.pushStackVar(variable)}},{key:"funcCallHandler",value:function funcCallHandler(context,token){var _context$_codeItems4;context.pushExecutionStack();context._codeItems=[];(_context$_codeItems4=context._codeItems).push.apply(_context$_codeItems4,babelHelpers.toConsumableArray(token.childItems));var node=new InterpreterNode;node.nType=InterpreterNodeType.ntFuncCallFinish;node.nValue=token;node.nValue2=context._stackVars.length;context._codeItems.push(node)}},{key:"funcParamHandler",value:function funcParamHandler(context,token){var _context$_codeItems5;context.pushExecutionStack();context._codeItems=[];(_context$_codeItems5=context._codeItems).push.apply(_context$_codeItems5,babelHelpers.toConsumableArray(token.childItems));var node=new InterpreterNode;node.nType=InterpreterNodeType.ntFuncParamFinish;context._codeItems.push(node)}},{key:"funcParamFinishHandler",value:function funcParamFinishHandler(context,token){var variable=context.popStackVar();context.popExecutionStack();context.pushStackVar(variable)}},{key:"funcCallFinishHandler",value:function funcCallFinishHandler(context,token){var paramCount=context._stackVars.length-token.nValue2;var parameters=[];while(paramCount>0){parameters.unshift(context.popStackVar());paramCount--}context.popExecutionStack();if(token.nValue2>context._stackVars.length)throw new Error("Stack corruption");var funcName=token.nValue.nValue;if(token.nValue.nValue2){funcName+="::"+token.nValue.nValue2}context.pushStackVar(context.callFunction(funcName,parameters))}},{key:"selfFuncCallHandler",value:function selfFuncCallHandler(context,token){var _context$_codeItems6;context.pushExecutionStack();context._codeItems=[];(_context$_codeItems6=context._codeItems).push.apply(_context$_codeItems6,babelHelpers.toConsumableArray(token.childItems));var node=new InterpreterNode;node.nType=InterpreterNodeType.ntSelfFuncCallFinish;node.nValue=token;node.nValue2=context._stackVars.length;context._codeItems.push(node)}},{key:"selfFuncCallFinishHandler",value:function selfFuncCallFinishHandler(context,token){var paramCount=context._stackVars.length-token.nValue2;var parameters=[];while(paramCount>0){parameters.unshift(context.popStackVar());paramCount--}context.popExecutionStack();if(token.nValue2>context._stackVars.length)throw new Error("Stack corruption");var funcName=token.nValue.nValue;if(token.nValue.nValue2){funcName+="::"+token.nValue.nValue2}var self=context.popStackVar();context.pushStackVar(context.selfCallFunction(self,funcName,parameters))}},{key:"shiftSPHandler",value:function shiftSPHandler(context,token){var count=token.nValue;while(count<0){if(!context._stackVars.length)throw new Error("Stack corruption");context.popStackVar();count++}}},{key:"objPropHandler",value:function objPropHandler(context,token){var variable=context.popStackVar(),getVar;getVar=variable.getProperty(token.nValue);if(!getVar){getVar=variable.functions[token.nValue];if(getVar)getVar=new StackVariableFunction(getVar,variable)}if(!getVar)throw new Error('Property or function "'+token.nValue+'" not found  on '+variable.typeName);context.pushStackVar(getVar)}},{key:"contextVariableHandler",value:function contextVariableHandler(context,token){var variable=context.getVariable(token.nValue);if(!variable)throw new Error("variable not defined "+token.nValue);context.pushStackVar(variable)}},{key:"ifHandler",value:function ifHandler(context,token){var _context$_codeItems7;var variable=context.createVariable(VariableType.vtBoolean,false);context.pushStackVar(variable);context.pushExecutionStack();context._codeItems=[];(_context$_codeItems7=context._codeItems).push.apply(_context$_codeItems7,babelHelpers.toConsumableArray(token.childItems));var node=new InterpreterNode;node.nType=InterpreterNodeType.ntIFFinish;context._codeItems.push(node)}},{key:"ifValueHandler",value:function ifValueHandler(context,token){var _context$_codeItems8;context.pushExecutionStack();context._codeItems=[];(_context$_codeItems8=context._codeItems).push.apply(_context$_codeItems8,babelHelpers.toConsumableArray(token.childItems));var node=new InterpreterNode;node.nType=InterpreterNodeType.ntIFValueFinish;context._codeItems.push(node)}},{key:"ifValueBOOLHandler",value:function ifValueBOOLHandler(context,token){var _context$_codeItems9;context.pushExecutionStack();context._codeItems=[];(_context$_codeItems9=context._codeItems).push.apply(_context$_codeItems9,babelHelpers.toConsumableArray(token.childItems));var node=new InterpreterNode;node.nType=InterpreterNodeType.ntIFValueBOOLFinish;context._codeItems.push(node)}},{key:"ifValueFinishHandler",value:function ifValueFinishHandler(context,token){var variable=context.popStackVar();context.popExecutionStack();context.pushStackVar(variable)}},{key:"ifValueBOOLFinishHandler",value:function ifValueBOOLFinishHandler(context,token){var variable=context.popStackVar();context.popExecutionStack();var compareVariable=context.createVariable(VariableType.vtBoolean,false);if(variable.isNumeric){compareVariable.value=variable.value!==0}else{switch(variable.type){case VariableType.vtString:compareVariable.value=variable.length>0;break;case VariableType.vtBoolean:compareVariable.value=variable.value;break;default:compareVariable.value=!!variable.value}}context.pushStackVar(compareVariable)}},{key:"expressionCompareHandler",value:function expressionCompareHandler(context,token){context.execGetVariable();var rightCompare=context.popStackVar(),leftCompare=context.popStackVar(),compareResult=context.createVariable(VariableType.vtBoolean,false);this.compareVariable(token.nValue,leftCompare,rightCompare,compareResult);context.pushStackVar(compareResult)}},{key:"ifCompareHandler",value:function ifCompareHandler(context,token){context.execGetVariable();var rightCompare=context.popStackVar(),leftCompare=context.popStackVar(),compareResult=context.createVariable(VariableType.vtBoolean,false);this.compareVariable(token.nValue,leftCompare,rightCompare,compareResult);context.pushStackVar(compareResult)}},{key:"compareVariable",value:function compareVariable(compareType,leftCompare,rightCompare,compareResult){var leftPriority=leftCompare.comparePriority(rightCompare,compareType),rightPriority=rightCompare.comparePriority(leftCompare,compareType);if(leftPriority===false&&rightPriority===false){throw new Error("Invalid compare types "+leftCompare.typeName+" and "+rightCompare.typeName)}if(leftPriority>=rightPriority){compareResult.value=leftCompare.compare(rightCompare,compareType);return}if((compareType&CompareType.ctGreat)===CompareType.ctGreat){compareType&=~CompareType.ctGreat;compareType|=CompareType.ctLess}else if((compareType&CompareType.ctLess)===CompareType.ctLess){compareType&=~CompareType.ctLess;compareType|=CompareType.ctGreat}compareResult.value=rightCompare.compare(leftCompare,compareType)}},{key:"ifCompareOrHandler",value:function ifCompareOrHandler(context,token){var variable=context.popStackVar();if(variable.type!==VariableType.vtBoolean)throw new Error("Invalid variable in IF Handler");context.pushStackVar(variable);if(variable.value===true){context._pos=context._codeItems.length-1}}},{key:"ifCompareAndHandler",value:function ifCompareAndHandler(context,token){var variable=context.popStackVar();if(variable.type!==VariableType.vtBoolean)throw new Error("Invalid variable in IF Handler");context.pushStackVar(variable);if(variable.value!==true){context._pos=context._codeItems.length-1}}},{key:"negativeIfHandler",value:function negativeIfHandler(context,token){context.execGetVariable();var variable=context.popStackVar(),newVariable=context.createVariable(VariableType.vtBoolean,!variable.value);context.pushStackVar(newVariable)}},{key:"negativeIfFinishHandler",value:function negativeIfFinishHandler(context,token){}},{key:"ifFinishHandler",value:function ifFinishHandler(context,token){var variable=context.popStackVar();if(variable.type!==VariableType.vtBoolean)throw new Error("Invalid variable in IF Handler");context.popExecutionStack();if(!variable.value){context.getNextInterToken();if(context.whoNextTypeInterToken===NodeType.ntELSE){context.getNextInterToken()}}}},{key:"subCodeHandler",value:function subCodeHandler(context,token){var _context$_codeItems10;context.pushExecutionStack();context._codeItems=[];(_context$_codeItems10=context._codeItems).push.apply(_context$_codeItems10,babelHelpers.toConsumableArray(token.childItems));var node=new InterpreterNode;node.nType=InterpreterNodeType.ntSubCodeFinish;context._codeItems.push(node)}},{key:"subCodeFinishHandler",value:function subCodeFinishHandler(context,token){context.popExecutionStack()}},{key:"elseHandler",value:function elseHandler(context,token){context.getNextInterToken()}},{key:"forHandler",value:function forHandler(context,token){var _context$_codeItems11;if(token.childItems.length!==4)throw new Error("for handler must be 4 child items");context.pushExecutionStack();context._type=ContextType.ctAllowBreak;context._codeItems=[];(_context$_codeItems11=context._codeItems).push.apply(_context$_codeItems11,babelHelpers.toConsumableArray(token.childItems[0].childItems));context._codeItems.push(token.childItems[1]);context._codeItems.push(token.childItems[3]);context._codeItems.push(token.childItems[2]);var node=new InterpreterNode;node.nType=InterpreterNodeType.ntForLoop;context._codeItems.push(node)}},{key:"forCompareHandler",value:function forCompareHandler(context,token){var _context$_codeItems12;var variable=context.createVariable(VariableType.vtBoolean,false);context.pushStackVar(variable);context.pushExecutionStack();context._codeItems=[];(_context$_codeItems12=context._codeItems).push.apply(_context$_codeItems12,babelHelpers.toConsumableArray(token.childItems));var node=new InterpreterNode;node.nType=InterpreterNodeType.ntForCompareFinish;context._codeItems.push(node)}},{key:"forCompareFinishHandler",value:function forCompareFinishHandler(context,token){var variable=context.popStackVar();if(variable.type!==VariableType.vtBoolean)throw new Error("For compare invalid variable type");if(variable.type!==VariableType.vtBoolean)throw new Error("Invalid variable in IF Handler");context.popExecutionStack();if(!variable.value){context.popExecutionStack()}}},{key:"forLoopHandler",value:function forLoopHandler(context,token){context._pos-=4}},{key:"returnHandler",value:function returnHandler(context,token){var _context$_codeItems13;if(token.childItems.length===0){var variable=context.createVariable(VariableType.vtVoid,false);while(context._executionStack.length){context.popExecutionStack()}context.pushStackVar(variable)}context.pushExecutionStack();context._codeItems=[];(_context$_codeItems13=context._codeItems).push.apply(_context$_codeItems13,babelHelpers.toConsumableArray(token.childItems));var node=new InterpreterNode;node.nType=InterpreterNodeType.ntReturnFinish;node.nValue=context._stackVars.length;context._codeItems.push(node)}},{key:"returnFinishHandler",value:function returnFinishHandler(context,token){var variable=context.popStackVar();while(context._executionStack.length){context.popExecutionStack()}context.pushStackVar(variable)}},{key:"breakHandler",value:function breakHandler(context,token){while(context._executionStack.length){var allowBreak=context._type===ContextType.ctAllowBreak;if(!allowBreak&&context._type!==ContextType.ctNormal){throw new Error("Invalid context execution stack type")}context.popExecutionStack();if(allowBreak)return}throw new Error("break invalid statement")}}]);return Interpreter}();var ContextType={ctNormal:0,ctAllowBreak:1};var ContextInterpreter=function(){function ContextInterpreter(codeItems,interpreter){babelHelpers.classCallCheck(this,ContextInterpreter);this._variables={};this._functions={};this._codeItems=codeItems;this._stackVars=[];this._pos=0;this._type=ContextType.ctNormal;this._executionStack=[];this._interpreter=interpreter}babelHelpers.createClass(ContextInterpreter,[{key:"destroy",value:function destroy(){this.reset();this._variables=false;this._functions=false;this._codeItems=false;this._stackVars=false;this._executionStack=false;this._interpreter=false}},{key:"registerConst",value:function registerConst(){this.setVariable("undefined",new StackVariableUndefined(true));this.setVariable("null",new StackVariableNull(true));this.setVariable("true",new StackVariableBoolean(true,true));this.setVariable("false",new StackVariableBoolean(true,false))}},{key:"pushExecutionStack",value:function pushExecutionStack(){this._executionStack.push({variables:this._variables,functions:this._functions,codeItems:this._codeItems,type:this._type,pos:this._pos,stackVars:this._stackVars});this._variables=Object.assign({},this._variables);this._functions=Object.assign({},this._functions);this._stackVars=[];this._codeItems=null;this._pos=0;this._type=ContextType.ctNormal}},{key:"popExecutionStack",value:function popExecutionStack(saveVariables){var _this9=this;if(!this._executionStack.length)throw new Error("Execution stack is empty");var data=this._executionStack.pop();if(saveVariables!==true){var tmp=this._variables;this._variables=data.variables;Object.keys(this._variables).forEach(function(k){if(_this9._variables[k].isConst)return;if(_this9._variables[k].type!==tmp[k].type){_this9._variables[k]=_this9.createVariable(tmp[k].type,tmp[k].value)}else{_this9._variables[k].value=tmp[k].value}})}this._functions=data.functions;this._codeItems=data.codeItems;this._pos=data.pos;this._type=data.type;this._stackVars=data.stackVars}},{key:"pushStackVar",value:function pushStackVar(data){this._stackVars.push(data)}},{key:"popStackVar",value:function popStackVar(){var r=this._stackVars.pop();if(r===undefined)throw Error("Stack is empty");return r}},{key:"getNextInterToken",value:function getNextInterToken(){if(this._pos>=this._codeItems.length)throw new Error("End of execution code");return this._codeItems[this._pos++]}},{key:"execOne",value:function execOne(){var token=this.getNextInterToken(),handler=this._interpreter.getCodeHandler(token.nType);if(!handler)throw Error("no registered handler for token "+token.typeName+"("+token.nType+")");handler(this,token)}},{key:"execStepOver",value:function execStepOver(){var executionPos=this._executionStack.length;do{this.execOne()}while(executionPos!==this._executionStack.length)}},{key:"execGetVariable",value:function execGetVariable(){while(true){this.execStepOver();var nextToken=this.currentToken;if(!nextToken)break;if(nextToken.isCompareOrAndNode()||nextToken.isMathNode())break;if(nextToken instanceof InterpreterNode)break}}},{key:"exec",value:function exec(returnVal){var stackPosition=this._stackVars.length;while(!this.eof){this.execOne()}if(returnVal===true){if(this._stackVars.length>stackPosition){return this.popStackVar()}return this.createVariable(VariableType.vtVoid)}else{if(stackPosition!==this._stackVars.length)throw new Error("Execution stack corrupted")}}},{key:"getVariable",value:function getVariable(name){return this._variables[name]}},{key:"setVariable",value:function setVariable(name,value){if(!!this._variables[name]&&this._variables[name].isConst)throw new Error("Cannot override constant");this._variables[name]=value}},{key:"createVariable",value:function createVariable(type,value){switch(type){case VariableType.vtInteger:case VariableType.vtFloat:case VariableType.vtNumber:return new StackVariableNumber(false,value);case VariableType.vtString:return new StackVariableString(false,value);case VariableType.vtBoolean:return new StackVariableBoolean(false,value);case VariableType.vtArray:return new StackVariableArray(false,value);case VariableType.vtNull:return new StackVariableNull(false);case VariableType.vtUndefined:return new StackVariableUndefined(false);case VariableType.vtVoid:return new StackVariable(VariableType.vtVoid);default:throw new Error("Unknown variable type "+type)}}},{key:"reset",value:function reset(){while(this._executionStack.length){this.popExecutionStack()}this._variables={};this._functions={};this._stackVars=[];this._pos=0;this._type=ContextType.ctNormal;this._executionStack=[]}},{key:"callFunction",value:function callFunction(name,parameters){throw new Error("Call global function "+name)}},{key:"selfCallFunction",value:function selfCallFunction(self,name,parameters){var varFunction=self.functions[name];if(varFunction===undefined||varFunction===null){throw Error('Unknown function "'+name+'"')}var requiredParamsCnt=0;varFunction.arguments.forEach(function(arg){if(typeof arg["default"]!=="function")requiredParamsCnt++});if(requiredParamsCnt>parameters.length){throw Error('Invalid number of arguments for function "'+name+'"')}var funcArgs=[self];varFunction.arguments.forEach(function(funcArg,index){if(index<parameters.length){funcArgs.push(parameters[index].value)}else{funcArgs.push(funcArg["default"]().value)}});return varFunction.func.apply(this,funcArgs)}},{key:"whoNextTypeInterToken",get:function get(){if(this._pos>=this._codeItems.length)return NodeType.ntNotSet;return this._codeItems[this._pos].nType}},{key:"currentToken",get:function get(){if(this._pos>=this._codeItems.length)return null;return this._codeItems[this._pos]}},{key:"eof",get:function get(){return this._pos>=this._codeItems.length}}]);return ContextInterpreter}();var StackVariableDateTimeObject=function(_StackVariable){babelHelpers.inherits(StackVariableDateTimeObject,_StackVariable);function StackVariableDateTimeObject(value){var _this;babelHelpers.classCallCheck(this,StackVariableDateTimeObject);_this=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(StackVariableDateTimeObject).call(this,VariableType.vtObject,true));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(_this),"properties",{Today:{get:function get(){var d,variable;d=new Date;d.setHours(0,0,0,0);variable=new StackVariableDateTimeObject;variable._value=Math.floor(d.getTime()/1e3);return variable}},Now:{get:function get(){var d,variable;d=new Date;variable=new StackVariableDateTimeObject;variable._value=Math.floor(d.getTime()/1e3);return variable}},Year:{get:function get(){var d=new Date(this.value);if(d)return new StackVariableNumber(true,d.getFullYear());return undefined}},Month:{get:function get(){var d=new Date(this.value);if(d)return new StackVariableNumber(true,d.getMonth()+1);return undefined}},Day:{get:function get(){var d=new Date(this.value);if(d)return new StackVariableNumber(true,d.getDate());return undefined}},Hour:{get:function get(){var d=new Date(this.value);if(d)return new StackVariableNumber(true,d.getHours());return undefined}},Minute:{get:function get(){var d=new Date(this.value);if(d)return new StackVariableNumber(true,d.getMinutes());return undefined}},DayOfWeek:{get:function get(){var d=new Date(this.value);if(d)return new StackVariableNumber(true,d.getDay());return undefined}},Time:{get:function get(){var d=new Date(this.value);if(d){var variable=new StackVariableDateTimeObject;variable._value=d.getHours()*60*60+d.getMinutes()*60+d.getSeconds();return variable}return undefined}}});if(typeof value==="number")_this._value=Math.floor(value);_this.dateRegex=/^(\d{4})-(\d{2})-(\d{2})$/;_this.dateTimeRegex=/^(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2})$/;_this.dateTimeSecRegex=/^(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;_this.timeRegex=/^(\d{2}):(\d{2})$/;_this.timeSecRegex=/^(\d{2}):(\d{2}):(\d{2})$/;return _this}babelHelpers.createClass(StackVariableDateTimeObject,[{key:"comparePriority",value:function comparePriority(variable,compareType){if(variable instanceof StackVariableDateTimeObject)return 1;if(variable.isNumeric)return 1;if(variable.type===VariableType.vtString){var m=variable.value.match(this.dateTimeSecRegex);if(!m)m=variable.value.match(this.dateTimeRegex);if(!m)m=variable.value.match(this.dateRegex);if(!m)m=variable.value.match(this.timeSecRegex);if(!m)m=variable.value.match(this.timeRegex);if(m===null)return false;return 1}return false}},{key:"compare",value:function compare(variable,compareType){var compareValue=false;if(variable instanceof StackVariableDateTimeObject||variable.isNumeric){compareValue=variable.value}else if(variable.type===VariableType.vtString){var m=variable.value.match(this.dateTimeSecRegex);if(!m)m=variable.value.match(this.dateTimeRegex);if(!m)m=variable.value.match(this.dateRegex);if(m){var date=new Date(parseInt(m[1]),parseInt(m[2])-1,parseInt(m[3]),m[4]?parseInt(m[4]):0,m[5]?parseInt(m[5]):0,m[6]?parseInt(m[6]):0,0);if(date)compareValue=Math.floor(date.getTime()/1e3)}else{m=variable.value.match(this.timeSecRegex);if(!m)m=variable.value.match(this.timeRegex);if(m){compareValue=parseInt(m[1])*60*60+parseInt(m[2])*60;if(m[3])compareValue+=parseInt(m[3])}}}if(typeof compareValue!=="number")return false;switch(compareType){case CompareType.ctEqual:return this.value==compareValue;case CompareType.ctNotEqual:return this.value!=compareValue;case CompareType.ctLess:return this.value<compareValue;case CompareType.ctGreat:return this.value>compareValue;case CompareType.ctEqual|CompareType.ctLess:return this.value<=compareValue;case CompareType.ctEqual|CompareType.ctGreat:return this.value>=compareValue;default:throw new Error("Unknown compare type "+compareType)}}},{key:"functions",get:function get(){return{AddDays:{arguments:[{name:"days",type:VariableType.vtInteger}],func:function func(self,days){if(typeof self.value!=="number")throw new Error("Invalid date");return new StackVariableDateTimeObject(self.value+days*60*60*24)}},AddHours:{arguments:[{name:"hours",type:VariableType.vtInteger}],func:function func(self,hours){if(typeof self.value!=="number")throw new Error("Invalid date");return new StackVariableDateTimeObject(self.value+hours*60*60)}},AddMinutes:{arguments:[{name:"minutes",type:VariableType.vtInteger}],func:function func(self,minutes){if(typeof self.value!=="number")throw new Error("Invalid date");return new StackVariableDateTimeObject(self.value+minutes*60)}},AddSeconds:{arguments:[{name:"minutes",type:VariableType.vtInteger}],func:function func(self,seconds){if(typeof self.value!=="number")throw new Error("Invalid date");return new StackVariableDateTimeObject(self.value+seconds)}}}}}]);return StackVariableDateTimeObject}(StackVariable);exports.CodeLexer=CodeLexer;exports.LexerTypeArray=LexerTypeArray;exports.LexerType=LexerType;exports.Lexer=Lexer;exports.TokenCursor=TokenCursor;exports.FullTokenInfo=FullTokenInfo;exports.CodeParser=CodeParser;exports.NodeType=NodeType;exports.CompareType=CompareType;exports.ParseNode=ParseNode;exports.Interpreter=Interpreter;exports.ContextInterpreter=ContextInterpreter;exports.StackVariable=StackVariable;exports.StackVariableUndefined=StackVariableUndefined;exports.StackVariableNull=StackVariableNull;exports.StackVariableNumber=StackVariableNumber;exports.StackVariableString=StackVariableString;exports.StackVariableBoolean=StackVariableBoolean;exports.StackVariableArray=StackVariableArray;exports.StackVariableObject=StackVariableObject;exports.StackVariableDateTimeObject=StackVariableDateTimeObject;exports.VariableType=VariableType;exports.InterpreterNode=InterpreterNode;exports.ContextType=ContextType})(this.DevBX.MSLang=this.DevBX.MSLang||{});